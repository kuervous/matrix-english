<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MATRIX MASTER ENCYCLOPEDIA: COMPLETE DATA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --m-green: #00FF41; --m-dark: #001500; --m-bg: #030303; --m-red: #ff3131; --m-blue: #00d4ff; --m-yellow: #FFD700; --m-panel: #071d13; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--m-bg); color: #fff; font-family: 'Courier New', monospace; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .mobile-nav { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; background: var(--m-dark); border-bottom: 2px solid var(--m-green); z-index: 1000; }
        .menu-btn { font-size: 1.5rem; color: var(--m-green); cursor: pointer; }
        .app-core { display: flex; flex: 1; overflow: hidden; }
        #sidebar { width: 300px; background: #000; border-right: 2px solid var(--m-green); overflow-y: auto; transition: 0.3s; position: absolute; height: 100%; z-index: 999; transform: translateX(-100%); }
        #sidebar.open { transform: translateX(0); }
        @media (min-width: 992px) { #sidebar { position: relative; transform: translateX(0); } .mobile-nav { display: none; } }
        .chapter-btn { padding: 12px; border-bottom: 1px solid #1a1a1a; cursor: pointer; color: var(--m-green); font-size: 0.75em; transition: 0.2s; }
        .chapter-btn:hover, .chapter-btn.active { background: var(--m-green); color: #000; font-weight: bold; }
        #main-display { flex: 1; overflow-y: auto; padding: 20px; background: linear-gradient(180deg, #000 0%, #050505 100%); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--m-panel); border: 1px solid var(--m-green); padding: 10px; text-align: center; border-radius: 5px; }
        .stat-card span { display: block; font-size: 0.55em; color: var(--m-blue); }
        .stat-card b { font-size: 1em; color: var(--m-green); }
        .theory-box { background: #111; border-left: 4px solid var(--m-yellow); padding: 15px; margin-bottom: 15px; font-size: 0.8em; color: #ccc; }
        .practice-card { border: 2px solid var(--m-green); padding: 20px; background: rgba(0,255,65,0.05); border-radius: 10px; box-shadow: 0 0 15px rgba(0,255,65,0.1); }
        .text-en { font-size: 1.5em; margin-bottom: 10px; color: #fff; text-align: center; font-weight: bold; }
        .text-es { font-size: 0.95em; color: var(--m-green); font-style: italic; text-align: center; opacity: 0.8; }
        .eval-box { text-align: center; margin: 15px 0; }
        .score-val { font-size: 3em; font-weight: bold; color: var(--m-yellow); }
        .match { color: var(--m-green); }
        .miss { color: var(--m-red); text-decoration: line-through; }
        .controls { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .btn { background: #000; color: var(--m-green); border: 1px solid var(--m-green); padding: 12px 5px; cursor: pointer; font-size: 0.65em; font-weight: bold; text-transform: uppercase; border-radius: 4px; }
        .btn:hover { background: var(--m-green); color: #000; }
        .btn-rec.active { background: var(--m-red); color: #fff; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <nav class="mobile-nav">
        <div class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
        <div style="font-size: 0.8em; font-weight: bold; color: var(--m-green);">MATRIX MASTER V12</div>
        <div style="width: 30px;"></div>
    </nav>

    <div class="app-core">
        <div id="sidebar">
            <div style="padding: 20px; border-bottom: 2px solid var(--m-green); text-align: center; color: #fff; font-size: 0.9em;">
                <b>DATA NODES</b>
            </div>
            <div id="chapter-list"></div>
        </div>

        <main id="main-display">
            <div class="stats-grid">
                <div class="stat-card"><span>RANK</span><b id="rank-val">BATTERY</b></div>
                <div class="stat-card"><span>ACCURACY</span><b id="acc-val">0%</b></div>
                <div class="stat-card"><span>UNITS</span><b id="mast-val">0</b></div>
            </div>

            <div class="theory-box" id="theory-display">Cargando Sistema...</div>

            <div class="practice-card">
                <div id="unit-tag" style="font-size: 0.5em; text-align: right; color: var(--m-blue);">UNIT: 0/0</div>
                <div class="text-en" id="display-en">Neural Link Active.</div>
                <div class="text-es" id="display-es">Iniciando Entrenamiento...</div>

                <div class="eval-box">
                    <div id="diff-visual" style="font-size:0.8em;">...</div>
                    <div class="score-val" id="score-val">--</div>
                </div>

                <div class="controls">
                    <button class="btn" onclick="nav(-1)"><i class="fas fa-arrow-left"></i></button>
                    <button class="btn" onclick="speak()"><i class="fas fa-volume-up"></i></button>
                    <button class="btn btn-rec" id="recBtn" onclick="record()"><i class="fas fa-microphone"></i></button>
                    <button class="btn" onclick="toggleAuto()" id="autoBtn">AUTO</button>
                    <button class="btn" onclick="nav(1)"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 15px;">
                <button class="btn" style="width: 100%; border-color: red; color: red;" onclick="resetSystem()">RESETEAR MATRIX</button>
            </div>
        </main>
    </div>

<script>
    // ====== BASE DE DATOS INYECTADA (CAP 1-10 + VERBOS) ======
    const masterData = {
        "Capítulo 1: Present Time": [
            { sub: "1-1 Simple Present", theory: "Acciones habituales.", en: "I study every morning.", es: "Estudio cada mañana.", score: 0 },
            { sub: "1-1 Simple Present", theory: "Verdades de la naturaleza.", en: "Water boils at 100 degrees.", es: "El agua hierve a 100 grados.", score: 0 },
            { sub: "1-1 Present Progressive", theory: "Acciones ocurriendo ahora.", en: "I am writing a letter right now.", es: "Estoy escribiendo una carta ahora mismo.", score: 0 },
            { sub: "1-2 Forms", theory: "Tercera persona singular lleva -s.", en: "She works in a bank.", es: "Ella trabaja en un banco.", score: 0 },
            { sub: "1-3 Adverbs", theory: "Always (Siempre) va antes del verbo.", en: "I always drink coffee.", es: "Siempre bebo café.", score: 0 },
            { sub: "1-3 Adverbs", theory: "Never (Nunca).", en: "It never snows here.", es: "Nunca nieva aquí.", score: 0 },
            { sub: "1-4 Plurals", theory: "Sustantivos en plural.", en: "The students are in class.", es: "Los estudiantes están en clase.", score: 0 },
            { sub: "1-5 Spelling", theory: "Verbos terminados en CH.", en: "He watches television every night.", es: "Él ve televisión cada noche.", score: 0 },
            { sub: "1-6 Non-action", theory: "Verbos de estado: Know.", en: "I know your brother.", es: "Conozco a tu hermano.", score: 0 },
            { sub: "1-6 Non-action", theory: "Verbos de estado: Want.", en: "I want to learn English.", es: "Quiero aprender inglés.", score: 0 },
            { sub: "1-7 Short Answers", theory: "Respuestas cortas con Do.", en: "Yes, I do.", es: "Sí.", score: 0 },
            { sub: "1-7 Short Answers", theory: "Respuestas cortas con Be.", en: "No, he isn't.", es: "No, él no lo es.", score: 0 },
            { sub: "1-3 Frequency", theory: "Usually (Usualmente).", en: "I usually go to bed at ten.", es: "Usualmente me voy a la cama a las diez.", score: 0 },
            { sub: "1-4 Singular", theory: "Persona (Sujeto).", en: "The girl sings well.", es: "La niña canta bien.", score: 0 },
            { sub: "1-6 Senses", theory: "Verbo Oír (Hear).", en: "I hear the music.", es: "Oigo la música.", score: 0 },
            { sub: "1-6 Thinking", theory: "Verbo Creer (Believe).", en: "I believe you.", es: "Te creo.", score: 0 },
            { sub: "1-1 Progressive", theory: "Pregunta actual.", en: "Are you listening to me?", es: "¿Me estás escuchando?", score: 0 },
            { sub: "1-3 Adverbs", theory: "Hardly ever (Casi nunca).", en: "I hardly ever go out.", es: "Casi nunca salgo.", score: 0 },
            { sub: "1-5 Spelling", theory: "Verbo Ir (Go).", en: "She goes to school.", es: "Ella va a la escuela.", score: 0 },
            { sub: "1-6 Needs", theory: "Necesidad (Need).", en: "I need some help.", es: "Necesito algo de ayuda.", score: 0 },
            { sub: "1-1 Habits", theory: "Rutina diaria.", en: "He brushes his teeth.", es: "Él se cepilla los dientes.", score: 0 },
            { sub: "1-3 Position", theory: "Adverbio con el verbo BE.", en: "He is often late.", es: "Él llega tarde a menudo.", score: 0 },
            { sub: "1-6 Feelings", theory: "Gustar (Like).", en: "I like this book.", es: "Me gusta este libro.", score: 0 },
            { sub: "1-7 Questions", theory: "Pregunta de hábito.", en: "Does it rain in winter?", es: "¿Llueve en invierno?", score: 0 },
            { sub: "1-4 Nouns", theory: "Plural Irregular: Children.", en: "The children are happy.", es: "Los niños son felices.", score: 0 }
        ],
        "Capítulo 2: Past Time": [
            { sub: "2-1 Simple Past", theory: "Acción terminada.", en: "I walked home yesterday.", es: "Caminé a casa ayer.", score: 0 },
            { sub: "2-1 Past BE", theory: "Was (Era/Estaba).", en: "The weather was nice.", es: "El clima estaba agradable.", score: 0 },
            { sub: "2-1 Past BE", theory: "Were (Eran/Estaban).", en: "The shops were closed.", es: "Las tiendas estaban cerradas.", score: 0 },
            { sub: "2-2 Spelling", theory: "Doblar consonante (Stop).", en: "He stopped the car.", es: "Él detuvo el auto.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Comer (Eat-Ate).", en: "I ate an apple.", es: "Comí una manzana.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Ver (See-Saw).", en: "I saw a movie.", es: "Vi una película.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Ir (Go-Went).", en: "They went to Paris.", es: "Fueron a París.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Comprar (Buy-Bought).", en: "I bought a new phone.", es: "Compré un teléfono nuevo.", score: 0 },
            { sub: "2-1 Negative", theory: "Uso de Didn't.", en: "I didn't see you.", es: "No te vi.", score: 0 },
            { sub: "2-1 Questions", theory: "Pregunta con Did.", en: "Did you sleep well?", es: "¿Dormiste bien?", score: 0 },
            { sub: "2-6 Past Progressive", theory: "Acción en curso en el pasado.", en: "I was sleeping at midnight.", es: "Estaba durmiendo a medianoche.", score: 0 },
            { sub: "2-6 Interruption", theory: "Interrupción con When.", en: "I was eating when she called.", es: "Estaba comiendo cuando ella llamó.", score: 0 },
            { sub: "2-7 While", theory: "Acciones paralelas.", en: "While I was studying, he was cooking.", es: "Mientras yo estudiaba, él cocinaba.", score: 0 },
            { sub: "2-7 Time Clauses", theory: "Antes de (Before).", en: "I washed my hands before I ate.", es: "Me lavé las manos antes de comer.", score: 0 },
            { sub: "2-7 Time Clauses", theory: "Después de (After).", en: "I went to bed after I finished.", es: "Me fui a la cama después de terminar.", score: 0 },
            { sub: "2-8 Used To", theory: "Hábito del pasado.", en: "I used to play the piano.", es: "Solía tocar el piano.", score: 0 },
            { sub: "2-8 Negative Used To", theory: "Ya no lo hago.", en: "I didn't use to like coffee.", es: "No me solía gustar el café.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Tener (Have-Had).", en: "I had a busy day.", es: "Tuve un día ocupado.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Escribir (Write-Wrote).", en: "She wrote a long email.", es: "Ella escribió un correo largo.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Beber (Drink-Drank).", en: "He drank all the juice.", es: "Él se bebió todo el jugo.", score: 0 },
            { sub: "2-1 Past BE", theory: "Negativo (Wasn't).", en: "The test wasn't difficult.", es: "El examen no fue difícil.", score: 0 },
            { sub: "2-1 Questions BE", theory: "Pregunta de estado.", en: "Were you happy?", es: "¿Eras feliz?", score: 0 },
            { sub: "2-7 Until", theory: "Hasta que.", en: "I waited until it stopped raining.", es: "Esperé hasta que dejó de llover.", score: 0 },
            { sub: "2-7 As soon as", theory: "Tan pronto como.", en: "I called him as soon as I arrived.", es: "Le llamé tan pronto como llegué.", score: 0 },
            { sub: "2-5 Pronunciation", theory: "Sonido /id/ (Needed).", en: "I needed some water.", es: "Necesité algo de agua.", score: 0 }
        ],
        "Capítulo 3: Future Time": [
            { sub: "3-1 Be going to", theory: "Planes futuros.", en: "I am going to visit my aunt.", es: "Voy a visitar a mi tía.", score: 0 },
            { sub: "3-1 Will", theory: "Predicción.", en: "It will snow tomorrow.", es: "Nevará mañana.", score: 0 },
            { sub: "3-2 Negative", theory: "Not going to.", en: "I am not going to stay.", es: "No me voy a quedar.", score: 0 },
            { sub: "3-3 Will Decision", theory: "Decisión espontánea.", en: "I will help you with that.", es: "Te ayudaré con eso.", score: 0 },
            { sub: "3-4 Certainty", theory: "Certeza (Probably).", en: "He will probably be late.", es: "Él probablemente llegará tarde.", score: 0 },
            { sub: "3-4 Maybe", theory: "Posibilidad (50%).", en: "Maybe it will rain.", es: "Tal vez llueva.", score: 0 },
            { sub: "3-6 Time Clauses", theory: "Uso del presente.", en: "Before I go home, I will stop at the market.", es: "Antes de ir a casa, pasaré por el mercado.", score: 0 },
            { sub: "3-6 If Clause", theory: "Condición futura.", en: "If I have time, I will call you.", es: "Si tengo tiempo, te llamaré.", score: 0 },
            { sub: "3-7 Present Progressive", theory: "Planes confirmados.", en: "I am flying to New York tonight.", es: "Vuelo a Nueva York esta noche.", score: 0 },
            { sub: "3-8 Present Simple", theory: "Horarios fijos.", en: "The train leaves at eight.", es: "El tren sale a las ocho.", score: 0 },
            { sub: "3-9 Be about to", theory: "Futuro inminente.", en: "The movie is about to start.", es: "La película está a punto de empezar.", score: 0 },
            { sub: "3-10 Parallel", theory: "Dos acciones.", en: "I will eat and then study.", es: "Comeré y luego estudiaré.", score: 0 },
            { sub: "3-3 Promise", theory: "Promesa.", en: "I will always love you.", es: "Siempre te amaré.", score: 0 },
            { sub: "3-4 May", theory: "Posibilidad (May).", en: "It may be a nice day.", es: "Puede que sea un buen día.", score: 0 },
            { sub: "3-6 After", theory: "Cláusula con After.", en: "After I finish, I'm going to sleep.", es: "Después de terminar, voy a dormir.", score: 0 },
            { sub: "3-1 Prediction", theory: "Opinión.", en: "I think you will win.", es: "Creo que ganarás.", score: 0 },
            { sub: "3-2 Questions", theory: "Pregunta de planes.", en: "What are you going to do?", es: "¿Qué vas a hacer?", score: 0 },
            { sub: "3-3 Won't", theory: "Negación (Will not).", en: "I won't be late.", es: "No llegaré tarde.", score: 0 },
            { sub: "3-6 Until", theory: "Hasta.", en: "I'll stay until the rain stops.", es: "Me quedaré hasta que la lluvia pare.", score: 0 },
            { sub: "3-6 As soon as", theory: "Inmediatez.", en: "I'll tell him as soon as I see him.", es: "Se lo diré en cuanto le vea.", score: 0 },
            { sub: "3-1 Future", theory: "Mañana.", en: "I am going to work tomorrow.", es: "Voy a trabajar mañana.", score: 0 },
            { sub: "3-4 Probably", theory: "Probabilidad negativa.", en: "She probably won't come.", es: "Ella probablemente no vendrá.", score: 0 },
            { sub: "3-9 Immediate", theory: "Salida.", en: "I'm about to leave.", es: "Estoy a punto de irme.", score: 0 },
            { sub: "3-2 Informal", theory: "Gonna.", en: "I'm gonna learn English.", es: "Voy a aprender inglés.", score: 0 },
            { sub: "3-5 Plan", theory: "Intención.", en: "I'm going to paint my room.", es: "Voy a pintar mi cuarto.", score: 0 }
        ],
        "Capítulo 4: Present Perfect": [
            { sub: "4-1 Participle", theory: "Participio Regular (-ed).", en: "I have lived here for a year.", es: "He vivido aquí por un año.", score: 0 },
            { sub: "4-1 Participle", theory: "Participio Irregular (Seen).", en: "I have seen that movie twice.", es: "He visto esa película dos veces.", score: 0 },
            { sub: "4-2 Since", theory: "Punto de inicio.", en: "I have been here since ten o'clock.", es: "He estado aquí desde las diez.", score: 0 },
            { sub: "4-2 For", theory: "Duración.", en: "We have known him for ten years.", es: "Le conocemos desde hace diez años.", score: 0 },
            { sub: "4-3 Ever", theory: "¿Alguna vez?", en: "Have you ever been to Japan?", es: "¿Has estado alguna vez en Japón?", score: 0 },
            { sub: "4-3 Never", theory: "Experiencia negativa.", en: "I have never eaten snails.", es: "Nunca he comido caracoles.", score: 0 },
            { sub: "4-4 Just", theory: "Acaba de ocurrir.", en: "I have just finished my lunch.", es: "Acabo de terminar mi almuerzo.", score: 0 },
            { sub: "4-4 Recently", theory: "Recientemente.", en: "He has recently changed jobs.", es: "Él ha cambiado de trabajo recientemente.", score: 0 },
            { sub: "4-4 Already", theory: "Ya ocurrió.", en: "I have already seen it.", es: "Ya lo he visto.", score: 0 },
            { sub: "4-4 Yet", theory: "Aún no.", en: "I haven't finished yet.", es: "No he terminado aún.", score: 0 },
            { sub: "4-6 Progressive", theory: "Acción continua.", en: "It has been raining all day.", es: "Ha estado lloviendo todo el día.", score: 0 },
            { sub: "4-6 Progressive", theory: "Desde las 9:00.", en: "I've been sitting here since nine.", es: "He estado sentado aquí desde las nueve.", score: 0 },
            { sub: "4-8 Past Perfect", theory: "Pasado del pasado.", en: "He had left when I arrived.", es: "Él se había ido cuando llegué.", score: 0 },
            { sub: "4-8 Past Perfect", theory: "Antes de ayer.", en: "I had already eaten before the meeting.", es: "Ya había comido antes de la reunión.", score: 0 },
            { sub: "4-1 Participle", theory: "Written (Escrito).", en: "I have written a poem.", es: "He escrito un poema.", score: 0 },
            { sub: "4-1 Participle", theory: "Done (Hecho).", en: "I have done my homework.", es: "He hecho mi tarea.", score: 0 },
            { sub: "4-3 Experience", theory: "Varias veces.", en: "I have been to Paris many times.", es: "He estado en París muchas veces.", score: 0 },
            { sub: "4-4 Unspecified", theory: "Tiempo no mencionado.", en: "Someone has stolen my bike.", es: "Alguien ha robado mi bici.", score: 0 },
            { sub: "4-5 Past vs Perfect", theory: "Ayer (Past).", en: "I lost my keys yesterday.", es: "Perdí mis llaves ayer.", score: 0 },
            { sub: "4-6 Continuous", theory: "Haciendo algo.", en: "What have you been doing?", es: "¿Qué has estado haciendo?", score: 0 },
            { sub: "4-8 Before", theory: "Pasado perfecto.", en: "I had never seen a lion before.", es: "Nunca antes había visto un león.", score: 0 },
            { sub: "4-2 Cláusula", theory: "Since + Past.", en: "I have lived here since I was a child.", es: "He vivido aquí desde que era niño.", score: 0 },
            { sub: "4-4 Yet Question", theory: "Pregunta con Yet.", en: "Have you eaten yet?", es: "¿Has comido ya?", score: 0 },
            { sub: "4-6 Duration", theory: "Por dos horas.", en: "They have been talking for two hours.", es: "Han estado hablando por dos horas.", score: 0 },
            { sub: "4-1 Irregular", theory: "Bought (Comprado).", en: "She has bought a new car.", es: "Ella ha comprado un coche nuevo.", score: 0 }
        ],
        "Capítulo 5: Asking Questions": [
            { sub: "5-1 Yes/No", theory: "Pregunta simple.", en: "Do you need help?", es: "¿Necesitas ayuda?", score: 0 },
            { sub: "5-2 Information", theory: "Lugar (Where).", en: "Where do you live?", es: "¿Dónde vives?", score: 0 },
            { sub: "5-2 Information", theory: "Tiempo (When).", en: "When is your birthday?", es: "¿Cuándo es tu cumpleaños?", score: 0 },
            { sub: "5-3 Time", theory: "Hora (What time).", en: "What time does the class start?", es: "¿A qué hora empieza la clase?", score: 0 },
            { sub: "5-3 Reason", theory: "Razón (Why).", en: "Why are you laughing?", es: "¿Por qué te ríes?", score: 0 },
            { sub: "5-4 Subject", theory: "Who como sujeto.", en: "Who knows the answer?", es: "¿Quién sabe la respuesta?", score: 0 },
            { sub: "5-4 Object", theory: "Who como objeto.", en: "Who did you meet?", es: "¿A quién conociste?", score: 0 },
            { sub: "5-5 Activity", theory: "What + Do.", en: "What are you doing?", es: "¿Qué estás haciendo?", score: 0 },
            { sub: "5-6 Choice", theory: "Elección (Which).", en: "Which color do you prefer?", es: "¿Qué color prefieres?", score: 0 },
            { sub: "5-6 Kind", theory: "Tipo (What kind).", en: "What kind of music do you like?", es: "¿Qué tipo de música te gusta?", score: 0 },
            { sub: "5-7 Possession", theory: "Posesión (Whose).", en: "Whose book is this?", es: "¿De quién es este libro?", score: 0 },
            { sub: "5-8 Transport", theory: "Medio (How).", en: "How did you get here?", es: "¿Cómo llegaste aquí?", score: 0 },
            { sub: "5-8 Adjective", theory: "Edad (How old).", en: "How old are you?", es: "¿Qué edad tienes?", score: 0 },
            { sub: "5-9 Frequency", theory: "Frecuencia (How often).", en: "How often do you exercise?", es: "¿Qué tan seguido haces ejercicio?", score: 0 },
            { sub: "5-10 Distance", theory: "Distancia (How far).", en: "How far is it to London?", es: "¿A qué distancia está Londres?", score: 0 },
            { sub: "5-11 Duration", theory: "Duración (How long).", en: "How long does the movie last?", es: "¿Cuánto dura la película?", score: 0 },
            { sub: "5-14 Suggestions", theory: "Sugerencia (How about).", en: "How about a cup of tea?", es: "¿Qué tal una taza de té?", score: 0 },
            { sub: "5-15 Tags", theory: "Confirmación.", en: "You're a student, aren't you?", es: "Eres estudiante, ¿verdad?", score: 0 },
            { sub: "5-15 Tags", theory: "Negativo.", en: "He isn't busy, is he?", es: "Él no está ocupado, ¿cierto?", score: 0 },
            { sub: "5-15 Tags", theory: "Confirmación (Can).", en: "You can swim, can't you?", es: "Sabes nadar, ¿verdad?", score: 0 },
            { sub: "5-1 Questions", theory: "Con el auxiliar Have.", en: "Have you seen my keys?", es: "¿Has visto mis llaves?", score: 0 },
            { sub: "5-8 Adverb", theory: "Velocidad (How fast).", en: "How fast can you run?", es: "¿Qué tan rápido puedes correr?", score: 0 },
            { sub: "5-13 Senses", theory: "¿Cómo te sientes?", en: "How do you feel?", es: "¿Cómo te sientes?", score: 0 },
            { sub: "5-14 What about", theory: "Sugerencia alternativa.", en: "What about going to the park?", es: "¿Qué tal si vamos al parque?", score: 0 },
            { sub: "5-12 Contractions", theory: "Habla rápida.", en: "Whaddaya think?", es: "¿Qué piensas?", score: 0 }
        ],
        "Capítulo 6: Nouns & Pronouns": [
            { sub: "6-1 Plurals", theory: "Terminación en ES.", en: "The boxes are heavy.", es: "Las cajas son pesadas.", score: 0 },
            { sub: "6-1 Irregular", theory: "Diente (Tooth-Teeth).", en: "My teeth are white.", es: "Mis dientes son blancos.", score: 0 },
            { sub: "6-2 Pronunciation", theory: "Sonido /z/ (Laws).", en: "The laws are fair.", es: "Las leyes son justas.", score: 0 },
            { sub: "6-3 Subject/Object", theory: "Pronombre objeto (Me).", en: "He called me.", es: "Él me llamó.", score: 0 },
            { sub: "6-4 Prepositions", theory: "Lugar (On).", en: "The book is on the table.", es: "El libro está en la mesa.", score: 0 },
            { sub: "6-5 Time Prep.", theory: "Meses (In).", en: "My birthday is in October.", es: "Mi cumple es en octubre.", score: 0 },
            { sub: "6-6 Word Order", theory: "Lugar antes de tiempo.", en: "I went home at six.", es: "Fui a casa a las seis.", score: 0 },
            { sub: "6-7 Agreement", theory: "Sujeto-Verbo.", en: "The apples are red.", es: "Las manzanas son rojas.", score: 0 },
            { sub: "6-7 Every", theory: "Every es singular.", en: "Every student has a book.", es: "Cada estudiante tiene un libro.", score: 0 },
            { sub: "6-8 Adjectives", theory: "Modifican al nombre.", en: "The tall man is my friend.", es: "El hombre alto es mi amigo.", score: 0 },
            { sub: "6-9 Noun Adj.", theory: "Nombre como adjetivo.", en: "I have a flower garden.", es: "Tengo un jardín de flores.", score: 0 },
            { sub: "6-10 Pronouns", theory: "Objeto (Them).", en: "I like them.", es: "Me gustan.", score: 0 },
            { sub: "6-11 Possessive", theory: "Apóstrofe 'S.", en: "This is Tom's car.", es: "Este es el coche de Tom.", score: 0 },
            { sub: "6-11 Plural Poss.", theory: "Hermanos (Brothers').", en: "My brothers' names are Sam and Al.", es: "Los nombres de mis hermanos son Sam y Al.", score: 0 },
            { sub: "6-12 Poss. Adj.", theory: "Mi (My).", en: "This is my pen.", es: "Esta es mi pluma.", score: 0 },
            { sub: "6-12 Poss. Pron.", theory: "Mío (Mine).", en: "The pen is mine.", es: "La pluma es mía.", score: 0 },
            { sub: "6-13 Reflexive", theory: "Mismo (Myself).", en: "I saw myself in the mirror.", es: "Me vi en el espejo.", score: 0 },
            { sub: "6-14 Another", theory: "Otro más.", en: "I want another apple.", es: "Quiero otra manzana.", score: 0 },
            { sub: "6-15 Others", theory: "Los otros.", en: "Some are red, others are blue.", es: "Algunos son rojos, otros azules.", score: 0 },
            { sub: "6-3 Object", theory: "Pronombre Her.", en: "I saw her yesterday.", es: "La vi ayer.", score: 0 },
            { sub: "6-5 Time", theory: "Días (On).", en: "See you on Monday.", es: "Te veo el lunes.", score: 0 },
            { sub: "6-8 Order", theory: "Dos adjetivos.", en: "A small dark room.", es: "Un cuarto pequeño y oscuro.", score: 0 },
            { sub: "6-12 Posesivo", theory: "Su de ella (Her).", en: "Her hair is long.", es: "Su cabello es largo.", score: 0 },
            { sub: "6-13 Reflexivo", theory: "Él mismo (Himself).", en: "He lives by himself.", es: "Él vive solo.", score: 0 },
            { sub: "6-14 The other", theory: "El otro (específico).", en: "One is big, the other is small.", es: "Uno es grande, el otro pequeño.", score: 0 }
        ],
        "Capítulo 7: Modal Auxiliaries": [
            { sub: "7-2 Ability", theory: "Habilidad (Can).", en: "I can speak English.", es: "Puedo hablar inglés.", score: 0 },
            { sub: "7-2 Past Ability", theory: "Pasado (Could).", en: "I could swim when I was five.", es: "Podía nadar cuando tenía cinco.", score: 0 },
            { sub: "7-3 Possibility", theory: "Posibilidad (May).", en: "It may rain today.", es: "Puede que llueva hoy.", score: 0 },
            { sub: "7-3 Permission", theory: "Permiso formal.", en: "May I borrow your pen?", es: "¿Me presta su pluma?", score: 0 },
            { sub: "7-4 Possibility", theory: "Cierta posibilidad (Could).", en: "It could be true.", es: "Podría ser cierto.", score: 0 },
            { sub: "7-5 Polite Quest.", theory: "Pregunta cortés (Can I).", en: "Can I help you?", es: "¿Puedo ayudarle?", score: 0 },
            { sub: "7-6 Polite Request", theory: "Petición (Would you).", en: "Would you please open the door?", es: "¿Podría abrir la puerta, por favor?", score: 0 },
            { sub: "7-7 Advice", theory: "Consejo (Should).", en: "You should study harder.", es: "Deberías estudiar más.", score: 0 },
            { sub: "7-8 Advice", theory: "Consejo urgente (Had better).", en: "You had better see a doctor.", es: "Más vale que veas a un médico.", score: 0 },
            { sub: "7-9 Necessity", theory: "Obligación (Have to).", en: "I have to go now.", es: "Tengo que irme ahora.", score: 0 },
            { sub: "7-9 Necessity", theory: "Obligación fuerte (Must).", en: "You must stop at the red light.", es: "Debes parar en la luz roja.", score: 0 },
            { sub: "7-10 Lack of Nec.", theory: "No es necesario.", en: "You don't have to go.", es: "No tienes que ir.", score: 0 },
            { sub: "7-10 Prohibition", theory: "Prohibido (Must not).", en: "You must not smoke here.", es: "No debes fumar aquí.", score: 0 },
            { sub: "7-11 Logic", theory: "Conclusión lógica.", en: "She is yawning. She must be sleepy.", es: "Bosteza. Debe tener sueño.", score: 0 },
            { sub: "7-12 Tags", theory: "Tags con Modales.", en: "You can come, can't you?", es: "Puedes venir, ¿verdad?", score: 0 },
            { sub: "7-13 Imperative", theory: "Instrucción.", en: "Close the window.", es: "Cierra la ventana.", score: 0 },
            { sub: "7-14 Suggestions", theory: "Sugestión (Let's).", en: "Let's go to the beach.", es: "Vamos a la playa.", score: 0 },
            { sub: "7-15 Preference", theory: "Preferencia (Rather).", en: "I would rather stay home.", es: "Preferiría quedarme en casa.", score: 0 },
            { sub: "7-5 Cortesia", theory: "Petición (Could you).", en: "Could you tell me the time?", es: "¿Podría decirme la hora?", score: 0 },
            { sub: "7-7 Consejo", theory: "Ought to.", en: "You ought to eat more fruit.", es: "Deberías comer más fruta.", score: 0 },
            { sub: "7-9 Obligación", theory: "Have got to.", en: "I've got to study tonight.", es: "Tengo que estudiar esta noche.", score: 0 },
            { sub: "7-11 Deducción", theory: "Must not (Lógica).", en: "He must not like meat.", es: "No le debe gustar la carne.", score: 0 },
            { sub: "7-14 Sugerencia", theory: "Why don't we.", en: "Why don't we see a movie?", es: "¿Por qué no vemos una peli?", score: 0 },
            { sub: "7-15 Preferir", theory: "Preferir A sobre B.", en: "I prefer tea to coffee.", es: "Prefiero el té al café.", score: 0 },
            { sub: "7-13 Negativo", theory: "Imperativo negativo.", en: "Don't be late.", es: "No llegues tarde.", score: 0 }
        ],
        "Capítulo 8: Connecting Ideas": [
            { sub: "8-1 And", theory: "Unión simple.", en: "I saw a cat and a dog.", es: "Vi un gato y un perro.", score: 0 },
            { sub: "8-2 But", theory: "Contraste.", en: "I am tired but happy.", es: "Estoy cansado pero feliz.", score: 0 },
            { sub: "8-2 Or", theory: "Elección.", en: "Do you want tea or coffee?", es: "¿Quieres té o café?", score: 0 },
            { sub: "8-3 So", theory: "Resultado.", en: "It was dark, so I turned on the light.", es: "Estaba oscuro, así que encendí la luz.", score: 0 },
            { sub: "8-6 Because", theory: "Razón.", en: "He ate because he was hungry.", es: "Comió porque tenía hambre.", score: 0 },
            { sub: "8-7 Even though", theory: "Concesión.", en: "I went out even though it was raining.", es: "Salí aunque estaba lloviendo.", score: 0 },
            { sub: "8-1 Series", theory: "Lista de tres.", en: "I bought milk, bread, and eggs.", es: "Compré leche, pan y huevos.", score: 0 },
            { sub: "8-4 Auxiliaries", theory: "Uso de 'Does' tras But.", en: "I don't like coffee, but my husband does.", es: "A mí no me gusta el café, pero a mi esposo sí.", score: 0 },
            { sub: "8-5 Too", theory: "También (final).", en: "I am hungry, and Tom is too.", es: "Tengo hambre, y Tom también.", score: 0 },
            { sub: "8-5 So am I", theory: "También yo (inicio).", en: "I am tired. So am I.", es: "Estoy cansado. Yo también.", score: 0 },
            { sub: "8-5 Either", theory: "Tampoco (final).", en: "I don't swim, and Joe doesn't either.", es: "Yo no nado, y Joe tampoco.", score: 0 },
            { sub: "8-5 Neither", theory: "Tampoco yo (inicio).", en: "I'm not hungry. Neither am I.", es: "No tengo hambre. Ni yo.", score: 0 },
            { sub: "8-6 Adverb Clause", theory: "Porque (inicio).", en: "Because I was tired, I went to bed.", es: "Como estaba cansado, me fui a dormir.", score: 0 },
            { sub: "8-7 Although", theory: "Aunque.", en: "Although he is rich, he is unhappy.", es: "Aunque es rico, es infeliz.", score: 0 },
            { sub: "8-2 Contrast", theory: "Oposición.", en: "The movie was long but interesting.", es: "La película fue larga pero interesante.", score: 0 },
            { sub: "8-3 Result", theory: "Conclusión.", en: "I was sick, so I stayed home.", es: "Estaba enfermo, así que me quedé en casa.", score: 0 },
            { sub: "8-1 Addition", theory: "Suma.", en: "She is smart and beautiful.", es: "Ella es lista y hermosa.", score: 0 },
            { sub: "8-5 Agreement", theory: "Yo también (Can).", en: "I can dance. So can I.", es: "Sé bailar. Yo también.", score: 0 },
            { sub: "8-5 Tampoco", theory: "Ni yo (Have).", en: "I haven't seen it. Neither have I.", es: "No lo he visto. Ni yo.", score: 0 },
            { sub: "8-6 Causa", theory: "Causa.", en: "She's crying because she's sad.", es: "Llora porque está triste.", score: 0 },
            { sub: "8-7 Oposición", theory: "Oposición.", en: "She failed even though she studied.", es: "Reprobó aunque estudió.", score: 0 },
            { sub: "8-2 Opciones", theory: "Opciones.", en: "Is he a doctor or a nurse?", es: "¿Él es doctor o enfermero?", score: 0 },
            { sub: "8-4 Respuestas", theory: "Respuestas cortas.", en: "They can't go, but we can.", es: "Ellos no pueden ir, pero nosotros sí.", score: 0 },
            { sub: "8-1 Sujeto", theory: "Sujeto doble.", en: "My mom and dad are here.", es: "Mi mamá y papá están aquí.", score: 0 },
            { sub: "8-3 Consecuencia", theory: "Consecuencia.", en: "I forgot my wallet, so I have no money.", es: "Olvidé mi cartera, así que no tengo dinero.", score: 0 }
        ],
        "Capítulo 9: Comparisons": [
            { sub: "9-1 As...As", theory: "Igualdad.", en: "I am as tall as my brother.", es: "Soy tan alto como mi hermano.", score: 0 },
            { sub: "9-2 Comparative", theory: "Er (Cortos).", en: "An elephant is larger than a dog.", es: "Un elefante es más grande que un perro.", score: 0 },
            { sub: "9-2 Comparative", theory: "More (Largos).", en: "Health is more important than money.", es: "La salud es más importante que el dinero.", score: 0 },
            { sub: "9-2 Superlative", theory: "Est (Cortos).", en: "The Nile is the longest river.", es: "El Nilo es el río más largo.", score: 0 },
            { sub: "9-2 Superlative", theory: "Most (Largos).", en: "This is the most interesting book.", es: "Este es el libro más interesante.", score: 0 },
            { sub: "9-3 Irregular", theory: "Good - Better - Best.", en: "This cake is the best.", es: "Este pastel es el mejor.", score: 0 },
            { sub: "9-3 Irregular", theory: "Bad - Worse - Worst.", en: "The weather is worse today.", es: "El clima está peor hoy.", score: 0 },
            { sub: "9-5 Modifiers", theory: "Much (Mucho más).", en: "Tokyo is much bigger than Kyoto.", es: "Tokio es mucho más grande que Kioto.", score: 0 },
            { sub: "9-5 Modifiers", theory: "A little (Un poco).", en: "He is a little older than me.", es: "Él es un poco mayor que yo.", score: 0 },
            { sub: "9-6 Less", theory: "Menos que.", en: "A pen is less expensive than a watch.", es: "Una pluma es menos cara que un reloj.", score: 0 },
            { sub: "9-8 Repeating", theory: "Progresión.", en: "It is getting harder and harder.", es: "Se está poniendo cada vez más difícil.", score: 0 },
            { sub: "9-9 Double Comp.", theory: "Cuanto más... más...", en: "The harder you study, the more you learn.", es: "Cuanto más estudias, más aprendes.", score: 0 },
            { sub: "9-11 Alike", theory: "Parecidos.", en: "The two brothers are alike.", es: "Los dos hermanos se parecen.", score: 0 },
            { sub: "9-11 The same", theory: "Iguales.", en: "We have the same car.", es: "Tenemos el mismo coche.", score: 0 },
            { sub: "9-11 Different", theory: "Diferente a (From).", en: "My car is different from yours.", es: "Mi coche es diferente al tuyo.", score: 0 },
            { sub: "9-1 Negativo", theory: "No tanto como.", en: "He is not as old as he looks.", es: "No es tan viejo como parece.", score: 0 },
            { sub: "9-2 Than", theory: "Than (Comparativa).", en: "I am faster than you.", es: "Soy más rápido que tú.", score: 0 },
            { sub: "9-11 Similar", theory: "Similar.", en: "This book is similar to that one.", es: "Este libro es similar a ese.", score: 0 },
            { sub: "9-3 Far", theory: "Lejos (Farther).", en: "I ran farther than him.", es: "Corrí más lejos que él.", score: 0 },
            { sub: "9-1 Igualdad", theory: "Igual de rápido.", en: "He speaks as fast as he can.", es: "Él habla tan rápido como puede.", score: 0 },
            { sub: "9-5 A lot", theory: "Mucho mejor.", en: "I feel a lot better now.", es: "Me siento mucho mejor ahora.", score: 0 },
            { sub: "9-8 Better", theory: "Cada vez mejor.", en: "Your English is getting better and better.", es: "Tu inglés mejora cada vez más.", score: 0 },
            { sub: "9-9 Sooner", theory: "Cuanto antes mejor.", en: "The sooner, the better.", es: "Cuanto antes, mejor.", score: 0 },
            { sub: "9-11 Senses", theory: "Parece (Looks like).", en: "It looks like rain.", es: "Parece que va a llover.", score: 0 },
            { sub: "9-2 Superlativo", theory: "En el mundo.", en: "It's the tallest building in the world.", es: "Es el edificio más alto del mundo.", score: 0 }
        ],
        "Capítulo 10: The Passive": [
            { sub: "10-1 Active/Passive", theory: "Enfoque en el objeto.", en: "The mouse was eaten by the cat.", es: "El ratón fue comido por el gato.", score: 0 },
            { sub: "10-2 Form", theory: "Be + Participio.", en: "Rice is grown in Asia.", es: "El arroz se cultiva en Asia.", score: 0 },
            { sub: "10-2 Past Passive", theory: "Fue hecho.", en: "This house was built in 1940.", es: "Esta casa fue construida en 1940.", score: 0 },
            { sub: "10-2 Future Passive", theory: "Será enviado.", en: "The letter will be sent tomorrow.", es: "La carta será enviada mañana.", score: 0 },
            { sub: "10-4 By-Phrase", theory: "Quién lo hizo.", en: "The book was written by Betty Azar.", es: "El libro fue escrito por Betty Azar.", score: 0 },
            { sub: "10-5 Modals", theory: "Debe hacerse.", en: "The room must be cleaned.", es: "El cuarto debe ser limpiado.", score: 0 },
            { sub: "10-5 Modals", theory: "Puede hacerse.", en: "It can be done.", es: "Puede hacerse.", score: 0 },
            { sub: "10-6 Stative Pass.", theory: "Estado (Married).", en: "Paul is married to Susan.", es: "Paul está casado con Susan.", score: 0 },
            { sub: "10-6 Stative Pass.", theory: "Estado (Interesado).", en: "I am interested in art.", es: "Estoy interesado en el arte.", score: 0 },
            { sub: "10-6 Prepositions", theory: "Preocupado (Worried).", en: "I am worried about you.", es: "Estoy preocupado por ti.", score: 0 },
            { sub: "10-7 Participial Adj.", theory: "-ed vs -ing (Bored).", en: "I am bored.", es: "Estoy aburrido.", score: 0 },
            { sub: "10-7 Participial Adj.", theory: "-ed vs -ing (Boring).", en: "The movie is boring.", es: "La película es aburrida.", score: 0 },
            { sub: "10-8 Get + Adjective", theory: "Cambio (Get hungry).", en: "I am getting hungry.", es: "Me está dando hambre.", score: 0 },
            { sub: "10-8 Get + Participle", theory: "Casarse (Get married).", en: "They are getting married.", es: "Se van a casar.", score: 0 },
            { sub: "10-9 Be used to", theory: "Estar acostumbrado.", en: "I am used to hot weather.", es: "Estoy acostumbrado al clima cálido.", score: 0 },
            { sub: "10-9 Get used to", theory: "Acostumbrarse.", en: "I am getting used to the noise.", es: "Me estoy acostumbrando al ruido.", score: 0 },
            { sub: "10-11 Be supposed to", theory: "Se supone que...", en: "I am supposed to be there at eight.", es: "Se supone que debo estar ahí a las ocho.", score: 0 },
            { sub: "10-1 Passive", theory: "Mailed (Enviado).", en: "The package was mailed by Leo.", es: "El paquete fue enviado por Leo.", score: 0 },
            { sub: "10-2 Present Pass.", theory: "Es hecho.", en: "English is spoken here.", es: "Aquí se habla inglés.", score: 0 },
            { sub: "10-5 Should", theory: "Debería ser.", en: "He should be punished.", es: "Debería ser castigado.", score: 0 },
            { sub: "10-6 Tired", theory: "Cansado (De).", en: "I am tired of this cold weather.", es: "Estoy cansado de este clima frío.", score: 0 },
            { sub: "10-7 Scared", theory: "Asustado.", en: "The children were scared.", es: "Los niños estaban asustados.", score: 0 },
            { sub: "10-8 Lost", theory: "Perderse.", en: "We got lost in the city.", es: "Nos perdimos en la ciudad.", score: 0 },
            { sub: "10-9 Custom", theory: "Hábito.", en: "He's used to working hard.", es: "Él está acostumbrado a trabajar duro.", score: 0 },
            { sub: "10-11 Expectation", theory: "Expectativa.", en: "We are supposed to write a report.", es: "Se supone que debemos escribir un reporte.", score: 0 }
        ]
    };
    let azarBook = JSON.parse(localStorage.getItem('azar_final_v12')) || masterData;
    let currentCh = Object.keys(azarBook)[0];
    let currentSec = 0;
    let auto = false;
    const synth = window.speechSynthesis;
    const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = SpeechRec ? new SpeechRec() : null;

    if(rec) {
        rec.lang = 'en-US';
        rec.onresult = (e) => compare(e.results[0][0].transcript);
        rec.onend = () => document.getElementById('recBtn').classList.remove('active');
    }

    function init() {
        const list = document.getElementById('chapter-list');
        list.innerHTML = '';
        Object.keys(azarBook).forEach(ch => {
            const div = document.createElement('div');
            div.className = `chapter-btn ${ch === currentCh ? 'active' : ''}`;
            div.innerText = ch;
            div.onclick = () => { currentCh = ch; currentSec = 0; toggleMenu(); selectChapter(); };
            list.appendChild(div);
        });
        selectChapter();
    }

    function selectChapter() {
        init();
        updateUI();
        refreshStats();
    }

    function updateUI() {
        const item = azarBook[currentCh][currentSec];
        document.getElementById('theory-display').innerHTML = `<b>${item.sub}</b><br>${item.theory}`;
        document.getElementById('display-en').innerText = item.en;
        document.getElementById('display-es').innerText = item.es;
        document.getElementById('unit-tag').innerText = `UNIT: ${currentSec + 1}/${azarBook[currentCh].length}`;
        document.getElementById('score-val').innerText = item.score > 0 ? item.score + "%" : "--";
        localStorage.setItem('azar_final_v12', JSON.stringify(azarBook));
    }

    function nav(dir) {
        const len = azarBook[currentCh].length;
        currentSec = (currentSec + dir + len) % len;
        resetEval();
        updateUI();
        if(auto) speak();
    }

    function speak() {
        synth.cancel();
        const msg = new SpeechSynthesisUtterance(azarBook[currentCh][currentSec].en);
        msg.lang = 'en-US';
        msg.rate = 0.8;
        msg.onend = () => { if(auto && currentSec < azarBook[currentCh].length - 1) setTimeout(()=>nav(1), 1500); };
        synth.speak(msg);
    }

    function record() {
        if(!rec) return alert("Microphone not supported");
        document.getElementById('recBtn').classList.add('active');
        rec.start();
    }

    function compare(spoken) {
        const target = azarBook[currentCh][currentSec].en.toLowerCase().replace(/[^\w\s]/g, '');
        const words = target.split(' ');
        const spokenWords = spoken.toLowerCase().split(' ');
        let html = ''; let matches = 0;
        words.forEach(w => {
            if(spokenWords.includes(w)) { html += `<span class="match">${w}</span> `; matches++; }
            else { html += `<span class="miss">${w}</span> `; }
        });
        const score = Math.round((matches / words.length) * 100);
        azarBook[currentCh][currentSec].score = Math.max(azarBook[currentCh][currentSec].score, score);
        document.getElementById('diff-visual').innerHTML = html;
        document.getElementById('score-val').innerText = score + "%";
        refreshStats();
        updateUI();
    }

    function refreshStats() {
        let scores = []; let mastered = 0;
        Object.values(azarBook).forEach(ch => ch.forEach(item => {
            if(item.score > 0) scores.push(item.score);
            if(item.score >= 90) mastered++;
        }));
        const avg = scores.length ? Math.round(scores.reduce((a,b)=>a+b)/scores.length) : 0;
        document.getElementById('acc-val').innerText = avg + "%";
        document.getElementById('mast-val').innerText = mastered;
        let rank = "BATTERY";
        if(avg > 20) rank = "COPPER TOP";
        if(avg > 50) rank = "POTENTIAL";
        if(avg > 80) rank = "RED PILL";
        if(avg > 95) rank = "THE ONE";
        document.getElementById('rank-val').innerText = rank;
    }

    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
    function resetEval() { document.getElementById('diff-visual').innerHTML = "..."; document.getElementById('score-val').innerText = "--"; }
    function toggleAuto() { auto = !auto; document.getElementById('autoBtn').style.background = auto ? '#fff' : '#000'; if(auto) speak(); }
    function resetSystem() { if(confirm("¿Borrar todo el progreso?")) { localStorage.clear(); location.reload(); } }
    
    window.onload = init;
</script>
</body>
</html>

