<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>MATRIX MASTER ENCYCLOPEDIA: AZAR V10.0 MOBILE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== VARIABLES GLOBALES ====== */
        :root {
            --m-green: #00FF41;
            --m-green-glow: #00ff4140;
            --m-dark: #001500;
            --m-bg: #030303;
            --m-red: #ff3131;
            --m-blue: #00d4ff;
            --m-yellow: #FFD700;
            --m-panel: #071d13;
            --m-text: #e0e0e0;
            --m-border: #0a3;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
        }
        
        /* ====== RESET Y BASE ====== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: var(--m-bg);
            color: var(--m-text);
            font-family: 'Segoe UI', 'Courier New', monospace, system-ui;
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 65, 0.03) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 65, 0.03) 0%, transparent 25%);
        }
        
        /* ====== ESTRUCTURA PRINCIPAL RESPONSIVE ====== */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-width: 100vw;
        }
        
        /* ====== HEADER SUPERIOR (MOBILE) ====== */
        .mobile-header {
            display: none;
            background: var(--m-dark);
            border-bottom: 2px solid var(--m-green);
            padding: 12px 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .mobile-header .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .mobile-header .logo h1 {
            font-size: 1.1rem;
            color: var(--m-green);
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: var(--m-green);
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: auto;
        }
        
        /* ====== SIDEBAR (DESKTOP) ====== */
        .sidebar-desktop {
            width: 320px;
            background: linear-gradient(180deg, var(--m-dark) 0%, #000a06 100%);
            border-right: 2px solid var(--m-green);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid var(--m-border);
            background: rgba(0, 30, 0, 0.2);
        }
        
        .sidebar-header h2 {
            color: var(--m-green);
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .sidebar-header .subtitle {
            color: var(--m-blue);
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* ====== LISTA DE CAPÍTULOS ====== */
        .chapter-list-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .chapter-link {
            display: block;
            padding: 14px 16px;
            margin-bottom: 8px;
            background: rgba(2, 17, 9, 0.8);
            border: 1px solid transparent;
            border-left: 4px solid var(--m-green);
            color: var(--m-text);
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .chapter-link:hover {
            background: rgba(6, 43, 24, 0.8);
            border: 1px solid var(--m-green);
            transform: translateX(5px);
        }
        
        .chapter-link.active {
            background: linear-gradient(90deg, var(--m-dark), var(--m-green));
            color: #000;
            font-weight: bold;
            border: 1px solid var(--m-green);
            box-shadow: 0 0 15px var(--m-green-glow);
        }
        
        /* ====== CONTENIDO PRINCIPAL ====== */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        /* ====== DASHBOARD DE ESTADÍSTICAS ====== */
        .rank-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
            background: rgba(0, 21, 0, 0.3);
            border: 1px solid var(--m-border);
            border-radius: 12px;
            padding: 18px;
            backdrop-filter: blur(10px);
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 65, 0.2);
        }
        
        .stat-label {
            display: block;
            font-size: 0.75rem;
            color: var(--m-blue);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        
        .stat-val {
            display: block;
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--m-green);
            text-shadow: 0 0 10px var(--m-green-glow);
            line-height: 1.2;
        }
        
        /* ====== TARJETA DE TEORÍA ====== */
        .theory-card {
            background: rgba(7, 29, 19, 0.8);
            border: 1px solid var(--m-border);
            border-left: 5px solid var(--m-yellow);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        
        .theory-card strong {
            color: var(--m-yellow);
            font-size: 1rem;
            display: block;
            margin-bottom: 8px;
        }
        
        .theory-content {
            color: var(--m-text);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        /* ====== ÁREA DE PRÁCTICA ====== */
        .practice-frame {
            background: rgba(3, 21, 13, 0.9);
            border: 2px solid var(--m-green);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            box-shadow: 0 0 25px var(--m-green-glow);
        }
        
        .unit-counter {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.75rem;
            color: var(--m-blue);
            background: rgba(0, 0, 0, 0.6);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid var(--m-blue);
        }
        
        .char-label {
            display: inline-block;
            background: var(--m-green);
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
            padding: 6px 14px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .text-en {
            font-size: 1.7rem;
            color: #fff;
            font-weight: 600;
            margin: 20px 0;
            line-height: 1.4;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .text-es {
            font-size: 1.2rem;
            color: var(--m-blue);
            font-style: italic;
            margin: 15px 0 25px;
            text-align: center;
            min-height: 60px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-top: 2px dashed var(--m-blue);
        }
        
        /* ====== ZONA DE EVALUACIÓN ====== */
        .evaluation-zone {
            margin: 25px 0;
            text-align: center;
            min-height: 120px;
            padding: 15px;
            background: rgba(0, 30, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 65, 0.3);
        }
        
        .diff-visual {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            margin: 15px 0;
            line-height: 1.8;
            min-height: 40px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 6px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .match {
            color: var(--m-green);
            font-weight: bold;
        }
        
        .miss {
            color: var(--m-red);
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .score-circle {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--m-yellow);
            text-shadow: 0 0 20px gold;
            margin: 10px 0;
            font-family: 'Arial Black', sans-serif;
        }
        
        .transcript-visual {
            font-size: 1.1rem;
            color: var(--m-blue);
            font-style: italic;
            margin-top: 15px;
            min-height: 24px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 6px;
            border: 1px solid var(--m-blue);
        }
        
        /* ====== PANEL DE CONTROL ====== */
        .control-panel {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 25px;
        }
        
        .btn {
            background: linear-gradient(145deg, #031a10, #000c06);
            color: var(--m-green);
            border: 1px solid var(--m-green);
            padding: 16px 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            font-family: inherit;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
        }
        
        .btn:hover {
            background: var(--m-green);
            color: #000;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--m-green-glow);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn i {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .btn-rec {
            background: linear-gradient(145deg, #8b0000, #660000);
            border-color: #ff4444;
            color: #fff;
        }
        
        .btn-rec.active {
            background: #ff0000 !important;
            color: white !important;
            animation: pulse 1.5s infinite;
            border-color: #fff;
        }
        
        .btn-auto {
            background: linear-gradient(145deg, #004466, #002233);
            border-color: var(--m-blue);
            color: var(--m-blue);
        }
        
        .btn-auto.active {
            background: var(--m-blue) !important;
            color: #000 !important;
        }
        
        /* ====== CONSOLA DE ADMIN ====== */
        .admin-console {
            margin-top: 40px;
            border-top: 2px dashed var(--m-border);
            padding-top: 25px;
            opacity: 0.9;
            transition: opacity 0.3s;
        }
        
        .admin-console:hover {
            opacity: 1;
        }
        
        .admin-title {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .admin-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .admin-input-group label {
            color: var(--m-green);
            font-size: 0.85rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        textarea, input {
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--m-border);
            color: var(--m-text);
            padding: 14px;
            margin-bottom: 15px;
            font-family: inherit;
            font-size: 0.95rem;
            border-radius: 6px;
            transition: border 0.3s;
        }
        
        textarea:focus, input:focus {
            outline: none;
            border: 1px solid var(--m-green);
            box-shadow: 0 0 10px var(--m-green-glow);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .admin-actions {
            grid-column: span 2;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .btn-admin {
            padding: 16px;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .btn-export {
            background: linear-gradient(145deg, #333300, #222200);
            border-color: var(--m-yellow);
            color: var(--m-yellow);
        }
        
        .btn-reset {
            background: linear-gradient(145deg, #660000, #440000);
            border-color: var(--m-red);
            color: var(--m-red);
        }
        
        /* ====== ANIMACIONES ====== */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* ====== SCROLLBAR PERSONALIZADO ====== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 20, 0, 0.3);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--m-green);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00cc33;
        }
        
        /* ====== MEDIA QUERIES - RESPONSIVE ====== */
        
        /* TABLETS (768px a 1024px) */
        @media (max-width: 1024px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar-desktop {
                width: 100%;
                max-height: 300px;
                border-right: none;
                border-bottom: 2px solid var(--m-green);
            }
            
            .chapter-list-container {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 10px;
            }
            
            .chapter-link {
                margin-bottom: 0;
                text-align: center;
                padding: 12px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .control-panel {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .btn:nth-child(4), .btn:nth-child(5) {
                grid-column: span 3;
            }
            
            .admin-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-actions {
                grid-column: 1;
            }
        }
        
        /* MÓVILES GRANDES (576px a 768px) */
        @media (max-width: 768px) {
            .mobile-header {
                display: flex;
            }
            
            .sidebar-desktop {
                display: none;
                position: fixed;
                top: 60px;
                left: 0;
                width: 100%;
                height: calc(100vh - 60px);
                z-index: 999;
                border-bottom: none;
            }
            
            .sidebar-desktop.active {
                display: flex;
            }
            
            .main-content {
                padding: 15px 12px;
            }
            
            .rank-dashboard {
                grid-template-columns: repeat(3, 1fr);
                padding: 15px;
                gap: 10px;
            }
            
            .stat-val {
                font-size: 1.5rem;
            }
            
            .text-en {
                font-size: 1.4rem;
                padding: 12px;
                min-height: 70px;
            }
            
            .text-es {
                font-size: 1.1rem;
                min-height: 50px;
            }
            
            .practice-frame {
                padding: 20px 15px;
            }
            
            .score-circle {
                font-size: 2.8rem;
            }
            
            .btn {
                padding: 14px 6px;
                font-size: 0.8rem;
                min-height: 65px;
            }
            
            .btn i {
                font-size: 1.1rem;
            }
        }
        
        /* MÓVILES PEQUEÑOS (hasta 576px) */
        @media (max-width: 576px) {
            .mobile-header .logo h1 {
                font-size: 0.95rem;
            }
            
            .main-content {
                padding: 12px 10px;
            }
            
            .rank-dashboard {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .stat-item {
                padding: 10px;
            }
            
            .theory-card {
                padding: 15px;
            }
            
            .text-en {
                font-size: 1.2rem;
                min-height: 60px;
            }
            
            .text-es {
                font-size: 1rem;
            }
            
            .control-panel {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .btn {
                padding: 12px 4px;
                font-size: 0.75rem;
                min-height: 60px;
            }
            
            .btn i {
                font-size: 1rem;
                margin-bottom: 3px;
            }
            
            .btn:nth-child(3), .btn:nth-child(4), .btn:nth-child(5) {
                grid-column: span 2;
            }
            
            .score-circle {
                font-size: 2.2rem;
            }
            
            .transcript-visual {
                font-size: 0.95rem;
                padding: 8px;
            }
            
            .admin-console {
                margin-top: 30px;
                padding-top: 20px;
            }
            
            .admin-title {
                font-size: 1.1rem;
            }
            
            .admin-actions {
                grid-template-columns: 1fr;
            }
        }
        
        /* MÓVILES MUY PEQUEÑOS (hasta 360px) */
        @media (max-width: 360px) {
            .mobile-header {
                padding: 10px 12px;
            }
            
            .main-content {
                padding: 10px 8px;
            }
            
            .text-en {
                font-size: 1.1rem;
            }
            
            .text-es {
                font-size: 0.95rem;
            }
            
            .btn {
                padding: 10px 2px;
                font-size: 0.7rem;
                min-height: 55px;
            }
            
            .btn i {
                font-size: 0.9rem;
            }
            
            .practice-frame {
                padding: 15px 10px;
            }
            
            .theory-card {
                padding: 12px;
            }
        }
        
        /* ORIENTACIÓN HORIZONTAL EN MÓVILES */
        @media (max-height: 500px) and (orientation: landscape) {
            .app-container {
                flex-direction: row;
            }
            
            .sidebar-desktop {
                width: 280px;
                max-height: 100vh;
                border-right: 2px solid var(--m-green);
                border-bottom: none;
            }
            
            .mobile-header {
                display: none;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .text-en {
                font-size: 1.3rem;
                min-height: 60px;
            }
            
            .text-es {
                font-size: 1rem;
                min-height: 40px;
            }
        }
        
        /* IMPRESIÓN */
        @media print {
            .mobile-header, .sidebar-desktop, .control-panel, .admin-console {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
            }
            
            .practice-frame {
                border: 1px solid #000;
                box-shadow: none;
            }
            
            .text-en, .text-es {
                color: #000;
                background: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER MÓVIL -->
    <div class="mobile-header">
        <div class="logo">
            <i class="fas fa-matrix" style="color: var(--m-green); font-size: 1.5rem;"></i>
            <h1>MATRIX ENGLISH MASTER</h1>
        </div>
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <div class="app-container">
        <!-- SIDEBAR PARA DESKTOP -->
        <div class="sidebar-desktop" id="sidebarDesktop">
            <div class="sidebar-header">
                <h2><i class="fas fa-brain"></i> NEURAL TRAINING INTERFACE</h2>
                <div class="subtitle">Betty Azar Grammar System</div>
            </div>
            
            <div class="chapter-list-container">
                <!-- Capítulos se generarán dinámicamente -->
                <div id="chapterList"></div>
            </div>
            
            <div style="padding: 20px; text-align: center; border-top: 1px solid var(--m-border);">
                <div style="font-size: 0.8rem; color: var(--m-blue); margin-bottom: 10px;">
                    <i class="fas fa-database"></i> Total Units: <span id="totalUnits">0</span>
                </div>
                <div style="font-size: 0.8rem; color: var(--m-yellow);">
                    <i class="fas fa-trophy"></i> Mastered: <span id="masteredUnits">0</span>
                </div>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="main-content">
            <!-- DASHBOARD DE ESTADÍSTICAS -->
            <div class="rank-dashboard">
                <div class="stat-item">
                    <span class="stat-label">RANGO NEURONAL</span>
                    <span class="stat-val" id="rankVal">BATTERY</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">PRECISIÓN TOTAL</span>
                    <span class="stat-val" id="accuracyVal">0%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">UNIDADES DOMINADAS</span>
                    <span class="stat-val" id="masteredVal">0</span>
                </div>
            </div>

            <!-- TARJETA DE TEORÍA -->
            <div class="theory-card" id="theoryDisplay">
                <strong>SUBTEMA: 1-1 Simple Present</strong>
                <div class="theory-content" id="theoryContent">
                    Selecciona un capítulo para comenzar tu entrenamiento en la Matrix.
                </div>
            </div>

            <!-- ÁREA DE PRÁCTICA -->
            <div class="practice-frame">
                <div class="unit-counter" id="unitInfo">UNIT: 0 / 0</div>
                <div class="char-label">ACTIVE EXERCISE</div>
                
                <div class="text-en" id="displayEn">
                    Choose a chapter from the sidebar to start.
                </div>
                <div class="text-es" id="displayEs">
                    Selecciona un capítulo para comenzar.
                </div>
                
                <!-- ZONA DE EVALUACIÓN -->
                <div class="evaluation-zone">
                    <div class="diff-visual" id="diffVisual">...</div>
                    <div class="score-circle" id="scoreVal">--</div>
                    <div class="transcript-visual" id="transcriptTxt">
                        Neural Link: Standby
                    </div>
                </div>

                <!-- PANEL DE CONTROL -->
                <div class="control-panel">
                    <button class="btn" id="btnPrev" onclick="move(-1)">
                        <i class="fas fa-arrow-left"></i> Ant.
                    </button>
                    <button class="btn" id="btnPlay" onclick="speak()">
                        <i class="fas fa-volume-up"></i> Oír
                    </button>
                    <button class="btn btn-rec" id="btnRec" onclick="record()">
                        <i class="fas fa-microphone"></i> Grabar
                    </button>
                    <button class="btn btn-auto" id="btnAuto" onclick="toggleAuto()">
                        <i class="fas fa-robot"></i> Auto
                    </button>
                    <button class="btn" id="btnNext" onclick="move(1)">
                        <i class="fas fa-arrow-right"></i> Sig.
                    </button>
                </div>
            </div>

            <!-- CONSOLA DE ADMINISTRACIÓN -->
            <div class="admin-console">
                <div class="admin-title">
                    <i class="fas fa-terminal"></i> DATA TERMINAL - GESTIÓN DE LA MATRIX
                </div>
                
                <div class="admin-grid">
                    <div class="admin-input-group">
                        <label for="inSub"><i class="fas fa-tag"></i> SUBTEMA</label>
                        <input type="text" id="inSub" placeholder="Ej: 2-4 Irregular Verbs">
                    </div>
                    
                    <div class="admin-input-group">
                        <label for="inTheory"><i class="fas fa-book"></i> REGLA GRAMATICAL</label>
                        <textarea id="inTheory" placeholder="Describe la regla gramatical..."></textarea>
                    </div>
                    
                    <div class="admin-input-group">
                        <label for="inEn"><i class="fas fa-language"></i> FRASE EN INGLÉS</label>
                        <textarea id="inEn" placeholder="Escribe la frase en inglés..."></textarea>
                    </div>
                    
                    <div class="admin-input-group">
                        <label for="inEs"><i class="fas fa-flag"></i> TRADUCCIÓN ESPAÑOL</label>
                        <textarea id="inEs" placeholder="Escribe la traducción en español..."></textarea>
                    </div>
                    
                    <div class="admin-actions">
                        <button class="btn btn-admin" onclick="addNew()">
                            <i class="fas fa-plus-circle"></i> INYECTAR DATOS
                        </button>
                        <button class="btn btn-admin btn-export" onclick="exportData()">
                            <i class="fas fa-download"></i> EXPORTAR BACKUP
                        </button>
                        <button class="btn btn-admin btn-reset" onclick="resetAll()">
                            <i class="fas fa-trash-alt"></i> RESETEAR MATRIX
                        </button>
                        <button class="btn btn-admin" onclick="importData()">
                            <i class="fas fa-upload"></i> IMPORTAR DATOS
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== BASE DE DATOS COMPLETA ======
        const rawData = {
            "Capítulo 1: Present Time": [
                { sub: "1-1 Simple Present", theory: "Acciones habituales.", en: "I study every morning.", es: "Estudio cada mañana.", score: 0 },
                { sub: "1-1 Simple Present", theory: "Verdades de la naturaleza.", en: "Water boils at 100 degrees.", es: "El agua hierve a 100 grados.", score: 0 },
                { sub: "1-1 Present Progressive", theory: "Acciones ocurriendo ahora.", en: "I am writing a letter right now.", es: "Estoy escribiendo una carta ahora mismo.", score: 0 },
                { sub: "1-2 Forms", theory: "Tercera persona singular lleva -s.", en: "She works in a bank.", es: "Ella trabaja en un banco.", score: 0 },
                { sub: "1-3 Adverbs", theory: "Always (Siempre) va antes del verbo.", en: "I always drink coffee.", es: "Siempre bebo café.", score: 0 },
                { sub: "1-3 Adverbs", theory: "Never (Nunca).", en: "It never snows here.", es: "Nunca nieva aquí.", score: 0 },
                { sub: "1-4 Plurals", theory: "Sustantivos en plural.", en: "The students are in class.", es: "Los estudiantes están en clase.", score: 0 },
                { sub: "1-5 Spelling", theory: "Verbos terminados en CH.", en: "He watches television every night.", es: "Él ve televisión cada noche.", score: 0 },
                { sub: "1-6 Non-action", theory: "Verbos de estado: Know.", en: "I know your brother.", es: "Conozco a tu hermano.", score: 0 },
                { sub: "1-6 Non-action", theory: "Verbos de estado: Want.", en: "I want to learn English.", es: "Quiero aprender inglés.", score: 0 }
            ],
            "Capítulo 2: Past Time": [
                { sub: "2-1 Simple Past", theory: "Acción terminada.", en: "I walked home yesterday.", es: "Caminé a casa ayer.", score: 0 },
                { sub: "2-1 Past BE", theory: "Was (Era/Estaba).", en: "The weather was nice.", es: "El clima estaba agradable.", score: 0 },
                { sub: "2-1 Past BE", theory: "Were (Eran/Estaban).", en: "The shops were closed.", es: "Las tiendas estaban cerradas.", score: 0 },
                { sub: "2-2 Spelling", theory: "Doblar consonante (Stop).", en: "He stopped the car.", es: "Él detuvo el auto.", score: 0 },
                { sub: "2-4 Irregular", theory: "Verbo Comer (Eat-Ate).", en: "I ate an apple.", es: "Comí una manzana.", score: 0 },
                { sub: "2-4 Irregular", theory: "Verbo Ver (See-Saw).", en: "I saw a movie.", es: "Vi una película.", score: 0 },
                { sub: "2-4 Irregular", theory: "Verbo Ir (Go-Went).", en: "They went to Paris.", es: "Fueron a París.", score: 0 },
                { sub: "2-4 Irregular", theory: "Verbo Comprar (Buy-Bought).", en: "I bought a new phone.", es: "Compré un teléfono nuevo.", score: 0 },
                { sub: "2-1 Negative", theory: "Uso de Didn't.", en: "I didn't see you.", es: "No te vi.", score: 0 },
                { sub: "2-1 Questions", theory: "Pregunta con Did.", en: "Did you sleep well?", es: "¿Dormiste bien?", score: 0 }
            ],
            "Capítulo 3: Future Time": [
                { sub: "3-1 Be going to", theory: "Planes futuros.", en: "I am going to visit my aunt.", es: "Voy a visitar a mi tía.", score: 0 },
                { sub: "3-1 Will", theory: "Predicción.", en: "It will snow tomorrow.", es: "Nevará mañana.", score: 0 },
                { sub: "3-2 Negative", theory: "Not going to.", en: "I am not going to stay.", es: "No me voy a quedar.", score: 0 },
                { sub: "3-3 Will Decision", theory: "Decisión espontánea.", en: "I will help you with that.", es: "Te ayudaré con eso.", score: 0 },
                { sub: "3-4 Certainty", theory: "Certeza (Probably).", en: "He will probably be late.", es: "Él probablemente llegará tarde.", score: 0 },
                { sub: "3-4 Maybe", theory: "Posibilidad (50%).", en: "Maybe it will rain.", es: "Tal vez llueva.", score: 0 },
                { sub: "3-6 Time Clauses", theory: "Uso del presente.", en: "Before I go home, I will stop at the market.", es: "Antes de ir a casa, pasaré por el mercado.", score: 0 },
                { sub: "3-6 If Clause", theory: "Condición futura.", en: "If I have time, I will call you.", es: "Si tengo tiempo, te llamaré.", score: 0 },
                { sub: "3-7 Present Progressive", theory: "Planes confirmados.", en: "I am flying to New York tonight.", es: "Vuelo a Nueva York esta noche.", score: 0 },
                { sub: "3-8 Present Simple", theory: "Horarios fijos.", en: "The train leaves at eight.", es: "El tren sale a las ocho.", score: 0 }
            ],
            "Capítulo 4: Present Perfect": [
                { sub: "4-1 Participle", theory: "Participio Regular (-ed).", en: "I have lived here for a year.", es: "He vivido aquí por un año.", score: 0 },
                { sub: "4-1 Participle", theory: "Participio Irregular (Seen).", en: "I have seen that movie twice.", es: "He visto esa película dos veces.", score: 0 },
                { sub: "4-2 Since", theory: "Punto de inicio.", en: "I have been here since ten o'clock.", es: "He estado aquí desde las diez.", score: 0 },
                { sub: "4-2 For", theory: "Duración.", en: "We have known him for ten years.", es: "Le conocemos desde hace diez años.", score: 0 },
                { sub: "4-3 Ever", theory: "¿Alguna vez?", en: "Have you ever been to Japan?", es: "¿Has estado alguna vez en Japón?", score: 0 },
                { sub: "4-3 Never", theory: "Experiencia negativa.", en: "I have never eaten snails.", es: "Nunca he comido caracoles.", score: 0 },
                { sub: "4-4 Just", theory: "Acaba de ocurrir.", en: "I have just finished my lunch.", es: "Acabo de terminar mi almuerzo.", score: 0 },
                { sub: "4-4 Recently", theory: "Recientemente.", en: "He has recently changed jobs.", es: "Él ha cambiado de trabajo recientemente.", score: 0 },
                { sub: "4-4 Already", theory: "Ya ocurrió.", en: "I have already seen it.", es: "Ya lo he visto.", score: 0 },
                { sub: "4-4 Yet", theory: "Aún no.", en: "I haven't finished yet.", es: "No he terminado aún.", score: 0 }
            ],
            "Capítulo 5: Asking Questions": [
                { sub: "5-1 Yes/No", theory: "Pregunta simple.", en: "Do you need help?", es: "¿Necesitas ayuda?", score: 0 },
                { sub: "5-2 Information", theory: "Lugar (Where).", en: "Where do you live?", es: "¿Dónde vives?", score: 0 },
                { sub: "5-2 Information", theory: "Tiempo (When).", en: "When is your birthday?", es: "¿Cuándo es tu cumpleaños?", score: 0 },
                { sub: "5-3 Time", theory: "Hora (What time).", en: "What time does the class start?", es: "¿A qué hora empieza la clase?", score: 0 },
                { sub: "5-3 Reason", theory: "Razón (Why).", en: "Why are you laughing?", es: "¿Por qué te ríes?", score: 0 },
                { sub: "5-4 Subject", theory: "Who como sujeto.", en: "Who knows the answer?", es: "¿Quién sabe la respuesta?", score: 0 },
                { sub: "5-4 Object", theory: "Who como objeto.", en: "Who did you meet?", es: "¿A quién conociste?", score: 0 },
                { sub: "5-5 Activity", theory: "What + Do.", en: "What are you doing?", es: "¿Qué estás haciendo?", score: 0 },
                { sub: "5-6 Choice", theory: "Elección (Which).", en: "Which color do you prefer?", es: "¿Qué color prefieres?", score: 0 },
                { sub: "5-6 Kind", theory: "Tipo (What kind).", en: "What kind of music do you like?", es: "¿Qué tipo de música te gusta?", score: 0 }
            ]
        };

        // ====== VARIABLES GLOBALES ======
        let azarBook = JSON.parse(localStorage.getItem('azar_master_v10')) || rawData;
        let currentCh = Object.keys(azarBook)[0];
        let currentSec = 0;
        let autoMode = false;
        let autoTimer = null;
        const synth = window.speechSynthesis;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        
        if (recognition) {
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('transcriptTxt').innerHTML = `<i class="fas fa-user"></i> Entendido: "${transcript}"`;
                compare(transcript);
            };
            
            recognition.onend = () => {
                document.getElementById('btnRec').classList.remove('active');
                document.getElementById('btnRec').innerHTML = '<i class="fas fa-microphone"></i> Grabar';
            };
            
            recognition.onerror = (event) => {
                console.error('Error en reconocimiento:', event.error);
                document.getElementById('transcriptTxt').innerHTML = `<i class="fas fa-exclamation-triangle"></i> Error: ${event.error}`;
                document.getElementById('btnRec').classList.remove('active');
                document.getElementById('btnRec').innerHTML = '<i class="fas fa-microphone"></i> Grabar';
            };
        }

        // ====== FUNCIONES DE INTERFAZ ======
        function initSidebar() {
            const chapterList = document.getElementById('chapterList');
            chapterList.innerHTML = '';
            
            Object.keys(azarBook).forEach((chapter, index) => {
                const btn = document.createElement('div');
                btn.className = `chapter-link ${chapter === currentCh ? 'active' : ''}`;
                btn.innerHTML = `
                    <div style="font-weight: 600;">${chapter}</div>
                    <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 3px;">
                        ${azarBook[chapter].length} unidades
                    </div>
                `;
                btn.onclick = () => {
                    currentCh = chapter;
                    currentSec = 0;
                    selectChapter();
                    // En móviles, cerrar el sidebar después de seleccionar
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebarDesktop').classList.remove('active');
                    }
                };
                chapterList.appendChild(btn);
            });
            
            // Calcular estadísticas totales
            let totalUnits = 0;
            let masteredUnits = 0;
            
            Object.values(azarBook).forEach(chapter => {
                totalUnits += chapter.length;
                chapter.forEach(item => {
                    if (item.score >= 90) masteredUnits++;
                });
            });
            
            document.getElementById('totalUnits').textContent = totalUnits;
            document.getElementById('masteredUnits').textContent = masteredUnits;
        }
        
        function selectChapter() {
            initSidebar();
            updateLesson();
            refreshStats();
            
            // Efecto visual de transición
            document.querySelector('.practice-frame').classList.add('fade-in');
            setTimeout(() => {
                document.querySelector('.practice-frame').classList.remove('fade-in');
            }, 500);
        }
        
        function updateLesson() {
            const data = azarBook[currentCh];
            if (!data || data.length === 0) return;
            
            const item = data[currentSec];
            
            // Actualizar información de unidad
            document.getElementById('unitInfo').textContent = `UNIT: ${currentSec + 1} / ${data.length}`;
            
            // Actualizar teoría
            document.getElementById('theoryDisplay').innerHTML = `
                <strong>SUBTEMA: ${item.sub}</strong>
                <div class="theory-content">${item.theory}</div>
            `;
            
            // Actualizar frases
            document.getElementById('displayEn').textContent = item.en;
            document.getElementById('displayEs').textContent = item.es;
            
            // Actualizar puntuación
            const scoreDisplay = document.getElementById('scoreVal');
            if (item.score > 0) {
                scoreDisplay.textContent = `${item.score}%`;
                scoreDisplay.style.color = getScoreColor(item.score);
            } else {
                scoreDisplay.textContent = '--';
                scoreDisplay.style.color = 'var(--m-yellow)';
            }
            
            // Actualizar botones de navegación
            document.getElementById('btnPrev').disabled = currentSec === 0;
            document.getElementById('btnNext').disabled = currentSec === data.length - 1;
            
            // Guardar en localStorage
            localStorage.setItem('azar_master_v10', JSON.stringify(azarBook));
        }
        
        function getScoreColor(score) {
            if (score >= 90) return '#00FF00'; // Verde brillante
            if (score >= 70) return '#FFFF00'; // Amarillo
            if (score >= 50) return '#FF9900'; // Naranja
            return '#FF3333'; // Rojo
        }
        
        // ====== FUNCIONALIDADES DE VOZ ======
        function speak() {
            if (!synth) {
                alert('Tu navegador no soporta síntesis de voz');
                return;
            }
            
            const item = azarBook[currentCh][currentSec];
            const utterance = new SpeechSynthesisUtterance(item.en);
            utterance.lang = 'en-US';
            utterance.rate = 0.85;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            // Cambiar icono durante la reproducción
            const btn = document.getElementById('btnPlay');
            btn.innerHTML = '<i class="fas fa-volume-up"></i> Reproduciendo...';
            btn.disabled = true;
            
            utterance.onend = () => {
                btn.innerHTML = '<i class="fas fa-volume-up"></i> Oír';
                btn.disabled = false;
                
                // Si está activo el modo auto, avanzar después de un tiempo
                if (autoMode && currentSec < azarBook[currentCh].length - 1) {
                    autoTimer = setTimeout(() => move(1), 1500);
                }
            };
            
            synth.cancel(); // Cancelar cualquier reproducción anterior
            synth.speak(utterance);
        }
        
        function record() {
            if (!recognition) {
                alert('Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.');
                return;
            }
            
            const btn = document.getElementById('btnRec');
            
            if (btn.classList.contains('active')) {
                // Detener grabación
                recognition.stop();
            } else {
                // Iniciar grabación
                try {
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-stop-circle"></i> Detener';
                    document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-microphone-alt"></i> Escuchando...';
                    recognition.start();
                } catch (error) {
                    console.error('Error al iniciar grabación:', error);
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="fas fa-microphone"></i> Grabar';
                }
            }
        }
        
        function compare(spokenText) {
            const item = azarBook[currentCh][currentSec];
            const target = item.en.toLowerCase().replace(/[^\w\s]/g, '');
            const spoken = spokenText.toLowerCase();
            
            const targetWords = target.split(' ');
            const spokenWords = spoken.split(' ');
            
            let html = '';
            let matches = 0;
            
            targetWords.forEach(word => {
                if (spokenWords.includes(word)) {
                    html += `<span class="match">${word}</span> `;
                    matches++;
                } else {
                    html += `<span class="miss">${word}</span> `;
                }
            });
            
            document.getElementById('diffVisual').innerHTML = html;
            
            // Calcular puntuación
            const score = Math.round((matches / targetWords.length) * 100);
            const finalScore = Math.max(item.score || 0, score);
            azarBook[currentCh][currentSec].score = finalScore;
            
            // Actualizar display de puntuación
            const scoreDisplay = document.getElementById('scoreVal');
            scoreDisplay.textContent = `${finalScore}%`;
            scoreDisplay.style.color = getScoreColor(finalScore);
            
            // Actualizar mensaje de feedback
            let feedback = '';
            if (score >= 90) {
                feedback = '<i class="fas fa-trophy"></i> ¡Excelente! Pronunciación perfecta';
            } else if (score >= 70) {
                feedback = '<i class="fas fa-thumbs-up"></i> Bien hecho, sigue practicando';
            } else if (score >= 50) {
                feedback = '<i class="fas fa-check-circle"></i> Puedes mejorar, intenta de nuevo';
            } else {
                feedback = '<i class="fas fa-exclamation-circle"></i> Necesitas más práctica';
            }
            
            document.getElementById('transcriptTxt').innerHTML = feedback;
            
            // Actualizar interfaz y estadísticas
            updateLesson();
            refreshStats();
            
            // Si está en modo auto y la puntuación es buena, avanzar automáticamente
            if (autoMode && score >= 70 && currentSec < azarBook[currentCh].length - 1) {
                setTimeout(() => move(1), 2000);
            }
        }
        
        // ====== NAVEGACIÓN ======
        function move(direction) {
            const data = azarBook[currentCh];
            const newIndex = currentSec + direction;
            
            if (newIndex >= 0 && newIndex < data.length) {
                currentSec = newIndex;
                resetFeedback();
                updateLesson();
                
                if (autoMode) {
                    // Cancelar timer anterior si existe
                    if (autoTimer) clearTimeout(autoTimer);
                    // Reproducir automáticamente después de un breve delay
                    autoTimer = setTimeout(speak, 500);
                }
            }
        }
        
        function resetFeedback() {
            document.getElementById('diffVisual').textContent = '...';
            document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-link"></i> Neural Link: Standby';
        }
        
        function toggleAuto() {
            autoMode = !autoMode;
            const btn = document.getElementById('btnAuto');
            
            if (autoMode) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-robot"></i> Auto ON';
                // Comenzar reproducción automática
                speak();
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-robot"></i> Auto';
                // Detener cualquier timer activo
                if (autoTimer) clearTimeout(autoTimer);
            }
        }
        
        // ====== ESTADÍSTICAS ======
        function refreshStats() {
            let totalScore = 0;
            let totalItems = 0;
            let mastered = 0;
            
            Object.values(azarBook).forEach(chapter => {
                chapter.forEach(item => {
                    if (item.score > 0) {
                        totalScore += item.score;
                        totalItems++;
                    }
                    if (item.score >= 90) mastered++;
                });
            });
            
            const avg = totalItems > 0 ? Math.round(totalScore / totalItems) : 0;
            
            document.getElementById('accuracyVal').textContent = `${avg}%`;
            document.getElementById('masteredVal').textContent = mastered;
            
            // Determinar rango
            let rank = "BATTERY";
            if (avg > 20) rank = "COPPER TOP";
            if (avg > 50) rank = "POTENTIAL";
            if (avg > 80) rank = "RED PILL";
            if (avg > 95) rank = "THE ONE";
            
            document.getElementById('rankVal').textContent = rank;
        }
        
        // ====== FUNCIONES DE ADMINISTRACIÓN ======
        function addNew() {
            const sub = document.getElementById('inSub').value.trim();
            const theory = document.getElementById('inTheory').value.trim();
            const en = document.getElementById('inEn').value.trim();
            const es = document.getElementById('inEs').value.trim();
            
            if (!en || !es) {
                alert('Por favor completa al menos la frase en inglés y su traducción');
                return;
            }
            
            // Asegurarse de que el capítulo actual existe
            if (!azarBook[currentCh]) {
                azarBook[currentCh] = [];
            }
            
            // Añadir nuevo ejercicio
            azarBook[currentCh].push({
                sub: sub || "Nuevo Subtema",
                theory: theory || "Nueva regla gramatical",
                en: en,
                es: es,
                score: 0
            });
            
            currentSec = azarBook[currentCh].length - 1;
            
            // Limpiar formulario
            document.getElementById('inSub').value = '';
            document.getElementById('inTheory').value = '';
            document.getElementById('inEn').value = '';
            document.getElementById('inEs').value = '';
            
            // Actualizar interfaz
            updateLesson();
            initSidebar();
            
            // Mostrar confirmación
            document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-check-circle"></i> Nuevo ejercicio añadido';
        }
        
        function exportData() {
            const dataStr = JSON.stringify(azarBook, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `matrix_english_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-download"></i> Backup exportado correctamente';
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        azarBook = importedData;
                        currentCh = Object.keys(azarBook)[0];
                        currentSec = 0;
                        
                        localStorage.setItem('azar_master_v10', JSON.stringify(azarBook));
                        
                        initSidebar();
                        updateLesson();
                        refreshStats();
                        
                        document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-check-circle"></i> Datos importados correctamente';
                    } catch (error) {
                        alert('Error al importar el archivo. Asegúrate de que es un JSON válido.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function resetAll() {
            if (confirm('¿Estás seguro de que quieres reiniciar toda la Matrix? Se perderán todos tus progresos.')) {
                localStorage.removeItem('azar_master_v10');
                azarBook = rawData;
                currentCh = Object.keys(azarBook)[0];
                currentSec = 0;
                
                initSidebar();
                updateLesson();
                refreshStats();
                
                document.getElementById('transcriptTxt').innerHTML = '<i class="fas fa-redo"></i> Matrix reiniciada a valores predeterminados';
            }
        }
        
        // ====== INICIALIZACIÓN ======
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar sidebar
            initSidebar();
            selectChapter();
            refreshStats();
            
            // Configurar botón de menú móvil
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebarDesktop').classList.toggle('active');
            });
            
            // Cerrar sidebar al hacer clic fuera en móviles
            document.addEventListener('click', (event) => {
                const sidebar = document.getElementById('sidebarDesktop');
                const menuToggle = document.getElementById('menuToggle');
                
                if (window.innerWidth <= 768 && 
                    sidebar.classList.contains('active') &&
                    !sidebar.contains(event.target) &&
                    !menuToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });
            
            // Atajos de teclado
            document.addEventListener('keydown', (event) => {
                // Evitar atajos cuando se está escribiendo en inputs
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
                
                switch(event.key) {
                    case 'ArrowLeft':
                        move(-1);
                        break;
                    case 'ArrowRight':
                        move(1);
                        break;
                    case ' ':
                        event.preventDefault();
                        speak();
                        break;
                    case 'r':
                    case 'R':
                        record();
                        break;
                    case 'a':
                    case 'A':
                        toggleAuto();
                        break;
                }
            });
            
            // Detectar cambios de orientación
            window.addEventListener('orientationchange', () => {
                // Pequeño delay para que la ventana se redimensione
                setTimeout(() => {
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebarDesktop').classList.remove('active');
                    }
                }, 300);
            });
            
            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                if (document.getElementById('transcriptTxt').innerText.includes('Standby')) {
                    document.getElementById('transcriptTxt').innerHTML = 
                        '<i class="fas fa-info-circle"></i> Usa las flechas del teclado para navegar. Presiona R para grabar.';
                }
            }, 3000);
        });
        
        // ====== DETECCIÓN DE VISIBILIDAD ======
        // Pausar audio cuando la página no está visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (synth.speaking) {
                    synth.cancel();
                }
                if (recognition && recognition.continuous) {
                    recognition.stop();
                }
            }
        });
    </script>
</body>
</html>
