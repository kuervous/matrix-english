<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATRIX MASTER ENCYCLOPEDIA: AZAR V9.0</title>
    <style>
        :root { --m-green: #00FF41; --m-dark: #001500; --m-bg: #030303; --m-red: #ff3131; --m-blue: #00d4ff; }
        * { box-sizing: border-box; }
        body { background: #000; color: var(--m-green); font-family: 'Courier New', monospace; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR DE CAP√çTULOS */
        #sidebar { width: 320px; background: var(--m-dark); border-right: 2px solid var(--m-green); overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .sidebar-header { font-size: 0.9em; text-align: center; padding-bottom: 15px; border-bottom: 1px solid var(--m-green); margin-bottom: 15px; color: #fff; }
        .chapter-link { padding: 12px; border: 1px solid transparent; cursor: pointer; font-size: 0.8em; margin-bottom: 6px; display: block; color: var(--m-green); text-decoration: none; border-radius: 4px; transition: 0.3s; }
        .chapter-link:hover { border: 1px solid var(--m-green); background: #000; box-shadow: 0 0 10px var(--m-green); }
        .chapter-link.active { background: var(--m-green); color: #000; font-weight: bold; }

        /* CONTENIDO PRINCIPAL */
        #main-content { flex-grow: 1; display: flex; flex-direction: column; padding: 25px; overflow-y: auto; background: var(--m-bg); }
        .rank-dashboard { display: flex; justify-content: space-around; background: #000; border: 1px solid var(--m-green); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .stat-item { text-align: center; font-size: 0.7em; text-transform: uppercase; }
        .stat-val { display: block; font-size: 1.5em; font-weight: bold; color: #fff; }

        /* √ÅREA DE LECCI√ìN */
        .theory-card { background: #111; border: 1px solid #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; line-height: 1.4; border-left: 4px solid gold; }
        .theory-card strong { color: gold; }
        
        .practice-frame { border: 2px solid var(--m-green); padding: 30px; background: rgba(0,30,0,0.2); box-shadow: 0 0 20px var(--m-green); border-radius: 12px; position: relative; }
        .unit-counter { position: absolute; top: 10px; right: 15px; font-size: 0.7em; opacity: 0.7; }
        .char-label { background: var(--m-green); color: #000; padding: 2px 10px; font-size: 0.7em; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        
        .text-en { font-size: 1.8em; color: #fff; margin: 15px 0; font-weight: bold; }
        .text-es { font-size: 1.2em; color: #008f11; font-style: italic; }

        /* FEEDBACK Y CONTROLES */
        .evaluation-zone { margin: 25px 0; text-align: center; min-height: 100px; }
        .score-circle { font-size: 3.5em; font-weight: bold; color: gold; text-shadow: 0 0 15px gold; margin: 10px 0; }
        .transcript-visual { font-size: 1em; color: var(--m-blue); margin-top: 10px; font-style: italic; }
        .match { color: var(--m-green); }
        .miss { color: var(--m-red); text-decoration: line-through; }

        .control-panel { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .btn { background: #000; color: var(--m-green); border: 1px solid var(--m-green); padding: 15px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-family: inherit; transition: 0.2s; }
        .btn:hover { background: var(--m-green); color: #000; transform: scale(1.02); }
        .btn:disabled { opacity: 0.2; cursor: not-allowed; }
        .btn-rec.active { background: red !important; color: #fff; animation: pulse 1s infinite; border-color: #fff; }

        /* ADMIN CONSOLE */
        .admin-console { margin-top: 50px; border-top: 1px solid #333; padding-top: 25px; opacity: 0.8; transition: 0.5s; }
        .admin-console:hover { opacity: 1; }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        textarea, input { width: 100%; background: #000; border: 1px solid #008f11; color: #fff; padding: 12px; margin-bottom: 10px; font-family: inherit; }

        @keyframes pulse { 50% { background: #900; } }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--m-green); }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/The_Matrix_stylized_logo.svg/1200px-The_Matrix_stylized_logo.svg.png" width="150" style="filter: invert(1); margin-bottom: 10px;"><br>
        NEURAL TRAINING INTERFACE
    </div>
    <div id="chapter-list"></div>
</div>

<div id="main-content">
    <div class="rank-dashboard">
        <div class="stat-item">RANGO NEURONAL<br><span class="stat-val" id="rank-val">BATTERY</span></div>
        <div class="stat-item">PRECISI√ìN TOTAL<br><span class="stat-val" id="accuracy-val">0%</span></div>
        <div class="stat-item">UNIDADES DOMINADAS<br><span class="stat-val" id="mastered-val">0</span></div>
    </div>

    <div id="active-lesson">
        <div class="theory-card" id="theory-display">Selecciona un m√≥dulo para iniciar.</div>

        <div class="practice-frame">
            <div class="unit-counter" id="unit-info">UNIT: 0 / 0</div>
            <div class="char-label">ACTIVE EXERCISE</div>
            <div class="text-en" id="display-en">Choose a chapter from the sidebar.</div>
            <div class="text-es" id="display-es">Selecciona un cap√≠tulo en la barra lateral.</div>
            
            <div class="evaluation-zone">
                <div id="diff-visual">...</div>
                <div class="score-circle" id="score-val">--</div>
                <div class="transcript-visual" id="transcript-txt">Neural Link: Standby</div>
            </div>

            <div class="control-panel">
                <button class="btn" onclick="move(-1)">¬´ Ant.</button>
                <button class="btn" onclick="speak()">üîä O√≠r</button>
                <button class="btn btn-rec" id="recBtn" onclick="record()">üéôÔ∏è Grabar</button>
                <button class="btn" id="autoBtn" onclick="toggleAuto()">Auto</button>
                <button class="btn" onclick="move(1)">Sig. ¬ª</button>
            </div>
        </div>
    </div>

    <div class="admin-console">
        <h3 style="color:#fff;">[DATA TERMINAL] GESTI√ìN DE LA MATRIX</h3>
        <div class="admin-grid">
            <div>
                <input type="text" id="in-sub" placeholder="SUBTEMA (Ej: 2-4 Irregular Verbs)">
                <textarea id="in-theory" rows="2" placeholder="REGLA GRAMATICAL"></textarea>
                <textarea id="in-en" rows="2" placeholder="FRASE EN INGL√âS"></textarea>
                <textarea id="in-es" rows="2" placeholder="TRADUCCI√ìN ESPA√ëOL"></textarea>
                <button class="btn" style="width:100%" onclick="addNew()">+ INYECTAR DATOS</button>
            </div>
            <div>
                <p style="font-size: 0.7em;">ACCIONES GLOBALES:</p>
                <button class="btn" style="width:100%; border-color: gold; color: gold; margin-bottom:10px;" onclick="exportData()">EXPORTAR BACKUP (.JSON)</button>
                <button class="btn" style="width:100%; border-color: red; color: red;" onclick="resetAll()">RESETEAR MATRIX</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- LA GRAN BASE DE DATOS (25 EJEMPLOS POR CAP√çTULO) ---
    const rawData = {
        "Cap√≠tulo 1: Present Time": [
            { sub: "1-1 Simple Present", theory: "Acciones habituales.", en: "I study every morning.", es: "Estudio cada ma√±ana.", score: 0 },
            { sub: "1-1 Simple Present", theory: "Verdades de la naturaleza.", en: "Water boils at 100 degrees.", es: "El agua hierve a 100 grados.", score: 0 },
            { sub: "1-1 Present Progressive", theory: "Acciones ocurriendo ahora.", en: "I am writing a letter right now.", es: "Estoy escribiendo una carta ahora mismo.", score: 0 },
            { sub: "1-2 Forms", theory: "Tercera persona singular lleva -s.", en: "She works in a bank.", es: "Ella trabaja en un banco.", score: 0 },
            { sub: "1-3 Adverbs", theory: "Always (Siempre) va antes del verbo.", en: "I always drink coffee.", es: "Siempre bebo caf√©.", score: 0 },
            { sub: "1-3 Adverbs", theory: "Never (Nunca).", en: "It never snows here.", es: "Nunca nieva aqu√≠.", score: 0 },
            { sub: "1-4 Plurals", theory: "Sustantivos en plural.", en: "The students are in class.", es: "Los estudiantes est√°n en clase.", score: 0 },
            { sub: "1-5 Spelling", theory: "Verbos terminados en CH.", en: "He watches television every night.", es: "√âl ve televisi√≥n cada noche.", score: 0 },
            { sub: "1-6 Non-action", theory: "Verbos de estado: Know.", en: "I know your brother.", es: "Conozco a tu hermano.", score: 0 },
            { sub: "1-6 Non-action", theory: "Verbos de estado: Want.", en: "I want to learn English.", es: "Quiero aprender ingl√©s.", score: 0 },
            { sub: "1-7 Short Answers", theory: "Respuestas cortas con Do.", en: "Yes, I do.", es: "S√≠.", score: 0 },
            { sub: "1-7 Short Answers", theory: "Respuestas cortas con Be.", en: "No, he isn't.", es: "No, √©l no lo es.", score: 0 },
            { sub: "1-3 Frequency", theory: "Usually (Usualmente).", en: "I usually go to bed at ten.", es: "Usualmente me voy a la cama a las diez.", score: 0 },
            { sub: "1-4 Singular", theory: "Persona (Sujeto).", en: "The girl sings well.", es: "La ni√±a canta bien.", score: 0 },
            { sub: "1-6 Senses", theory: "Verbo O√≠r (Hear).", en: "I hear the music.", es: "Oigo la m√∫sica.", score: 0 },
            { sub: "1-6 Thinking", theory: "Verbo Creer (Believe).", en: "I believe you.", es: "Te creo.", score: 0 },
            { sub: "1-1 Progressive", theory: "Pregunta actual.", en: "Are you listening to me?", es: "¬øMe est√°s escuchando?", score: 0 },
            { sub: "1-3 Adverbs", theory: "Hardly ever (Casi nunca).", en: "I hardly ever go out.", es: "Casi nunca salgo.", score: 0 },
            { sub: "1-5 Spelling", theory: "Verbo Ir (Go).", en: "She goes to school.", es: "Ella va a la escuela.", score: 0 },
            { sub: "1-6 Needs", theory: "Necesidad (Need).", en: "I need some help.", es: "Necesito algo de ayuda.", score: 0 },
            { sub: "1-1 Habits", theory: "Rutina diaria.", en: "He brushes his teeth.", es: "√âl se cepilla los dientes.", score: 0 },
            { sub: "1-3 Position", theory: "Adverbio con el verbo BE.", en: "He is often late.", es: "√âl llega tarde a menudo.", score: 0 },
            { sub: "1-6 Feelings", theory: "Gustar (Like).", en: "I like this book.", es: "Me gusta este libro.", score: 0 },
            { sub: "1-7 Questions", theory: "Pregunta de h√°bito.", en: "Does it rain in winter?", es: "¬øLlueve en invierno?", score: 0 },
            { sub: "1-4 Nouns", theory: "Plural Irregular: Children.", en: "The children are happy.", es: "Los ni√±os son felices.", score: 0 }
        ],
        "Cap√≠tulo 2: Past Time": [
            { sub: "2-1 Simple Past", theory: "Acci√≥n terminada.", en: "I walked home yesterday.", es: "Camin√© a casa ayer.", score: 0 },
            { sub: "2-1 Past BE", theory: "Was (Era/Estaba).", en: "The weather was nice.", es: "El clima estaba agradable.", score: 0 },
            { sub: "2-1 Past BE", theory: "Were (Eran/Estaban).", en: "The shops were closed.", es: "Las tiendas estaban cerradas.", score: 0 },
            { sub: "2-2 Spelling", theory: "Doblar consonante (Stop).", en: "He stopped the car.", es: "√âl detuvo el auto.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Comer (Eat-Ate).", en: "I ate an apple.", es: "Com√≠ una manzana.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Ver (See-Saw).", en: "I saw a movie.", es: "Vi una pel√≠cula.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Ir (Go-Went).", en: "They went to Paris.", es: "Fueron a Par√≠s.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Comprar (Buy-Bought).", en: "I bought a new phone.", es: "Compr√© un tel√©fono nuevo.", score: 0 },
            { sub: "2-1 Negative", theory: "Uso de Didn't.", en: "I didn't see you.", es: "No te vi.", score: 0 },
            { sub: "2-1 Questions", theory: "Pregunta con Did.", en: "Did you sleep well?", es: "¬øDormiste bien?", score: 0 },
            { sub: "2-6 Past Progressive", theory: "Acci√≥n en curso en el pasado.", en: "I was sleeping at midnight.", es: "Estaba durmiendo a medianoche.", score: 0 },
            { sub: "2-6 Interruption", theory: "Interrupci√≥n con When.", en: "I was eating when she called.", es: "Estaba comiendo cuando ella llam√≥.", score: 0 },
            { sub: "2-7 While", theory: "Acciones paralelas.", en: "While I was studying, he was cooking.", es: "Mientras yo estudiaba, √©l cocinaba.", score: 0 },
            { sub: "2-7 Time Clauses", theory: "Antes de (Before).", en: "I washed my hands before I ate.", es: "Me lav√© las manos antes de comer.", score: 0 },
            { sub: "2-7 Time Clauses", theory: "Despu√©s de (After).", en: "I went to bed after I finished.", es: "Me fui a la cama despu√©s de terminar.", score: 0 },
            { sub: "2-8 Used To", theory: "H√°bito del pasado.", en: "I used to play the piano.", es: "Sol√≠a tocar el piano.", score: 0 },
            { sub: "2-8 Negative Used To", theory: "Ya no lo hago.", en: "I didn't use to like coffee.", es: "No me sol√≠a gustar el caf√©.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Tener (Have-Had).", en: "I had a busy day.", es: "Tuve un d√≠a ocupado.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Escribir (Write-Wrote).", en: "She wrote a long email.", es: "Ella escribi√≥ un correo largo.", score: 0 },
            { sub: "2-4 Irregular", theory: "Verbo Beber (Drink-Drank).", en: "He drank all the juice.", es: "√âl se bebi√≥ todo el jugo.", score: 0 },
            { sub: "2-1 Past BE", theory: "Negativo (Wasn't).", en: "The test wasn't difficult.", es: "El examen no fue dif√≠cil.", score: 0 },
            { sub: "2-1 Questions BE", theory: "Pregunta de estado.", en: "Were you happy?", es: "¬øEras feliz?", score: 0 },
            { sub: "2-7 Until", theory: "Hasta que.", en: "I waited until it stopped raining.", es: "Esper√© hasta que dej√≥ de llover.", score: 0 },
            { sub: "2-7 As soon as", theory: "Tan pronto como.", en: "I called him as soon as I arrived.", es: "Le llam√© tan pronto como llegu√©.", score: 0 },
            { sub: "2-5 Pronunciation", theory: "Sonido /id/ (Needed).", en: "I needed some water.", es: "Necesit√© algo de agua.", score: 0 }
        ],
        "Cap√≠tulo 3: Future Time": [
            { sub: "3-1 Be going to", theory: "Planes futuros.", en: "I am going to visit my aunt.", es: "Voy a visitar a mi t√≠a.", score: 0 },
            { sub: "3-1 Will", theory: "Predicci√≥n.", en: "It will snow tomorrow.", es: "Nevar√° ma√±ana.", score: 0 },
            { sub: "3-2 Negative", theory: "Not going to.", en: "I am not going to stay.", es: "No me voy a quedar.", score: 0 },
            { sub: "3-3 Will Decision", theory: "Decisi√≥n espont√°nea.", en: "I will help you with that.", es: "Te ayudar√© con eso.", score: 0 },
            { sub: "3-4 Certainty", theory: "Certeza (Probably).", en: "He will probably be late.", es: "√âl probablemente llegar√° tarde.", score: 0 },
            { sub: "3-4 Maybe", theory: "Posibilidad (50%).", en: "Maybe it will rain.", es: "Tal vez llueva.", score: 0 },
            { sub: "3-6 Time Clauses", theory: "Uso del presente.", en: "Before I go home, I will stop at the market.", es: "Antes de ir a casa, pasar√© por el mercado.", score: 0 },
            { sub: "3-6 If Clause", theory: "Condici√≥n futura.", en: "If I have time, I will call you.", es: "Si tengo tiempo, te llamar√©.", score: 0 },
            { sub: "3-7 Present Progressive", theory: "Planes confirmados.", en: "I am flying to New York tonight.", es: "Vuelo a Nueva York esta noche.", score: 0 },
            { sub: "3-8 Present Simple", theory: "Horarios fijos.", en: "The train leaves at eight.", es: "El tren sale a las ocho.", score: 0 },
            { sub: "3-9 Be about to", theory: "Futuro inminente.", en: "The movie is about to start.", es: "La pel√≠cula est√° a punto de empezar.", score: 0 },
            { sub: "3-10 Parallel", theory: "Dos acciones.", en: "I will eat and then study.", es: "Comer√© y luego estudiar√©.", score: 0 },
            { sub: "3-3 Promise", theory: "Promesa.", en: "I will always love you.", es: "Siempre te amar√©.", score: 0 },
            { sub: "3-4 May", theory: "Posibilidad (May).", en: "It may be a nice day.", es: "Puede que sea un buen d√≠a.", score: 0 },
            { sub: "3-6 After", theory: "Cl√°usula con After.", en: "After I finish, I'm going to sleep.", es: "Despu√©s de terminar, voy a dormir.", score: 0 },
            { sub: "3-1 Prediction", theory: "Opini√≥n.", en: "I think you will win.", es: "Creo que ganar√°s.", score: 0 },
            { sub: "3-2 Questions", theory: "Pregunta de planes.", en: "What are you going to do?", es: "¬øQu√© vas a hacer?", score: 0 },
            { sub: "3-3 Won't", theory: "Negaci√≥n (Will not).", en: "I won't be late.", es: "No llegar√© tarde.", score: 0 },
            { sub: "3-6 Until", theory: "Hasta.", en: "I'll stay until the rain stops.", es: "Me quedar√© hasta que la lluvia pare.", score: 0 },
            { sub: "3-6 As soon as", theory: "Inmediatez.", en: "I'll tell him as soon as I see him.", es: "Se lo dir√© en cuanto le vea.", score: 0 },
            { sub: "3-1 Future", theory: "Ma√±ana.", en: "I am going to work tomorrow.", es: "Voy a trabajar ma√±ana.", score: 0 },
            { sub: "3-4 Probably", theory: "Probabilidad negativa.", en: "She probably won't come.", es: "Ella probablemente no vendr√°.", score: 0 },
            { sub: "3-9 Immediate", theory: "Salida.", en: "I'm about to leave.", es: "Estoy a punto de irme.", score: 0 },
            { sub: "3-2 Informal", theory: "Gonna.", en: "I'm gonna learn English.", es: "Voy a aprender ingl√©s.", score: 0 },
            { sub: "3-5 Plan", theory: "Intenci√≥n.", en: "I'm going to paint my room.", es: "Voy a pintar mi cuarto.", score: 0 }
        ],
        "Cap√≠tulo 4: Present Perfect": [
            { sub: "4-1 Participle", theory: "Participio Regular (-ed).", en: "I have lived here for a year.", es: "He vivido aqu√≠ por un a√±o.", score: 0 },
            { sub: "4-1 Participle", theory: "Participio Irregular (Seen).", en: "I have seen that movie twice.", es: "He visto esa pel√≠cula dos veces.", score: 0 },
            { sub: "4-2 Since", theory: "Punto de inicio.", en: "I have been here since ten o'clock.", es: "He estado aqu√≠ desde las diez.", score: 0 },
            { sub: "4-2 For", theory: "Duraci√≥n.", en: "We have known him for ten years.", es: "Le conocemos desde hace diez a√±os.", score: 0 },
            { sub: "4-3 Ever", theory: "¬øAlguna vez?", en: "Have you ever been to Japan?", es: "¬øHas estado alguna vez en Jap√≥n?", score: 0 },
            { sub: "4-3 Never", theory: "Experiencia negativa.", en: "I have never eaten snails.", es: "Nunca he comido caracoles.", score: 0 },
            { sub: "4-4 Just", theory: "Acaba de ocurrir.", en: "I have just finished my lunch.", es: "Acabo de terminar mi almuerzo.", score: 0 },
            { sub: "4-4 Recently", theory: "Recientemente.", en: "He has recently changed jobs.", es: "√âl ha cambiado de trabajo recientemente.", score: 0 },
            { sub: "4-4 Already", theory: "Ya ocurri√≥.", en: "I have already seen it.", es: "Ya lo he visto.", score: 0 },
            { sub: "4-4 Yet", theory: "A√∫n no.", en: "I haven't finished yet.", es: "No he terminado a√∫n.", score: 0 },
            { sub: "4-6 Progressive", theory: "Acci√≥n continua.", en: "It has been raining all day.", es: "Ha estado lloviendo todo el d√≠a.", score: 0 },
            { sub: "4-6 Progressive", theory: "Desde las 9:00.", en: "I've been sitting here since nine.", es: "He estado sentado aqu√≠ desde las nueve.", score: 0 },
            { sub: "4-8 Past Perfect", theory: "Pasado del pasado.", en: "He had left when I arrived.", es: "√âl se hab√≠a ido cuando llegu√©.", score: 0 },
            { sub: "4-8 Past Perfect", theory: "Antes de ayer.", en: "I had already eaten before the meeting.", es: "Ya hab√≠a comido antes de la reuni√≥n.", score: 0 },
            { sub: "4-1 Participle", theory: "Written (Escrito).", en: "I have written a poem.", es: "He escrito un poema.", score: 0 },
            { sub: "4-1 Participle", theory: "Done (Hecho).", en: "I have done my homework.", es: "He hecho mi tarea.", score: 0 },
            { sub: "4-3 Experience", theory: "Varias veces.", en: "I have been to Paris many times.", es: "He estado en Par√≠s muchas veces.", score: 0 },
            { sub: "4-4 Unspecified", theory: "Tiempo no mencionado.", en: "Someone has stolen my bike.", es: "Alguien ha robado mi bici.", score: 0 },
            { sub: "4-5 Past vs Perfect", theory: "Ayer (Past).", en: "I lost my keys yesterday.", es: "Perd√≠ mis llaves ayer.", score: 0 },
            { sub: "4-6 Continuous", theory: "Haciendo algo.", en: "What have you been doing?", es: "¬øQu√© has estado haciendo?", score: 0 },
            { sub: "4-8 Before", theory: "Pasado perfecto.", en: "I had never seen a lion before.", es: "Nunca antes hab√≠a visto un le√≥n.", score: 0 },
            { sub: "4-2 Cl√°usula", theory: "Since + Past.", en: "I have lived here since I was a child.", es: "He vivido aqu√≠ desde que era ni√±o.", score: 0 },
            { sub: "4-4 Yet Question", theory: "Pregunta con Yet.", en: "Have you eaten yet?", es: "¬øHas comido ya?", score: 0 },
            { sub: "4-6 Duration", theory: "Por dos horas.", en: "They have been talking for two hours.", es: "Han estado hablando por dos horas.", score: 0 },
            { sub: "4-1 Irregular", theory: "Bought (Comprado).", en: "She has bought a new car.", es: "Ella ha comprado un coche nuevo.", score: 0 }
        ],
        "Cap√≠tulo 5: Asking Questions": [
            { sub: "5-1 Yes/No", theory: "Pregunta simple.", en: "Do you need help?", es: "¬øNecesitas ayuda?", score: 0 },
            { sub: "5-2 Information", theory: "Lugar (Where).", en: "Where do you live?", es: "¬øD√≥nde vives?", score: 0 },
            { sub: "5-2 Information", theory: "Tiempo (When).", en: "When is your birthday?", es: "¬øCu√°ndo es tu cumplea√±os?", score: 0 },
            { sub: "5-3 Time", theory: "Hora (What time).", en: "What time does the class start?", es: "¬øA qu√© hora empieza la clase?", score: 0 },
            { sub: "5-3 Reason", theory: "Raz√≥n (Why).", en: "Why are you laughing?", es: "¬øPor qu√© te r√≠es?", score: 0 },
            { sub: "5-4 Subject", theory: "Who como sujeto.", en: "Who knows the answer?", es: "¬øQui√©n sabe la respuesta?", score: 0 },
            { sub: "5-4 Object", theory: "Who como objeto.", en: "Who did you meet?", es: "¬øA qui√©n conociste?", score: 0 },
            { sub: "5-5 Activity", theory: "What + Do.", en: "What are you doing?", es: "¬øQu√© est√°s haciendo?", score: 0 },
            { sub: "5-6 Choice", theory: "Elecci√≥n (Which).", en: "Which color do you prefer?", es: "¬øQu√© color prefieres?", score: 0 },
            { sub: "5-6 Kind", theory: "Tipo (What kind).", en: "What kind of music do you like?", es: "¬øQu√© tipo de m√∫sica te gusta?", score: 0 },
            { sub: "5-7 Possession", theory: "Posesi√≥n (Whose).", en: "Whose book is this?", es: "¬øDe qui√©n es este libro?", score: 0 },
            { sub: "5-8 Transport", theory: "Medio (How).", en: "How did you get here?", es: "¬øC√≥mo llegaste aqu√≠?", score: 0 },
            { sub: "5-8 Adjective", theory: "Edad (How old).", en: "How old are you?", es: "¬øQu√© edad tienes?", score: 0 },
            { sub: "5-9 Frequency", theory: "Frecuencia (How often).", en: "How often do you exercise?", es: "¬øQu√© tan seguido haces ejercicio?", score: 0 },
            { sub: "5-10 Distance", theory: "Distancia (How far).", en: "How far is it to London?", es: "¬øA qu√© distancia est√° Londres?", score: 0 },
            { sub: "5-11 Duration", theory: "Duraci√≥n (How long).", en: "How long does the movie last?", es: "¬øCu√°nto dura la pel√≠cula?", score: 0 },
            { sub: "5-14 Suggestions", theory: "Sugerencia (How about).", en: "How about a cup of tea?", es: "¬øQu√© tal una taza de t√©?", score: 0 },
            { sub: "5-15 Tags", theory: "Confirmaci√≥n.", en: "You're a student, aren't you?", es: "Eres estudiante, ¬øverdad?", score: 0 },
            { sub: "5-15 Tags", theory: "Negativo.", en: "He isn't busy, is he?", es: "√âl no est√° ocupado, ¬øcierto?", score: 0 },
            { sub: "5-15 Tags", theory: "Confirmaci√≥n (Can).", en: "You can swim, can't you?", es: "Sabes nadar, ¬øverdad?", score: 0 },
            { sub: "5-1 Questions", theory: "Con el auxiliar Have.", en: "Have you seen my keys?", es: "¬øHas visto mis llaves?", score: 0 },
            { sub: "5-8 Adverb", theory: "Velocidad (How fast).", en: "How fast can you run?", es: "¬øQu√© tan r√°pido puedes correr?", score: 0 },
            { sub: "5-13 Senses", theory: "¬øC√≥mo te sientes?", en: "How do you feel?", es: "¬øC√≥mo te sientes?", score: 0 },
            { sub: "5-14 What about", theory: "Sugerencia alternativa.", en: "What about going to the park?", es: "¬øQu√© tal si vamos al parque?", score: 0 },
            { sub: "5-12 Contractions", theory: "Habla r√°pida.", en: "Whaddaya think?", es: "¬øQu√© piensas?", score: 0 }
        ],
        "Cap√≠tulo 6: Nouns & Pronouns": [
            { sub: "6-1 Plurals", theory: "Terminaci√≥n en ES.", en: "The boxes are heavy.", es: "Las cajas son pesadas.", score: 0 },
            { sub: "6-1 Irregular", theory: "Diente (Tooth-Teeth).", en: "My teeth are white.", es: "Mis dientes son blancos.", score: 0 },
            { sub: "6-2 Pronunciation", theory: "Sonido /z/ (Laws).", en: "The laws are fair.", es: "Las leyes son justas.", score: 0 },
            { sub: "6-3 Subject/Object", theory: "Pronombre objeto (Me).", en: "He called me.", es: "√âl me llam√≥.", score: 0 },
            { sub: "6-4 Prepositions", theory: "Lugar (On).", en: "The book is on the table.", es: "El libro est√° en la mesa.", score: 0 },
            { sub: "6-5 Time Prep.", theory: "Meses (In).", en: "My birthday is in October.", es: "Mi cumple es en octubre.", score: 0 },
            { sub: "6-6 Word Order", theory: "Lugar antes de tiempo.", en: "I went home at six.", es: "Fui a casa a las seis.", score: 0 },
            { sub: "6-7 Agreement", theory: "Sujeto-Verbo.", en: "The apples are red.", es: "Las manzanas son rojas.", score: 0 },
            { sub: "6-7 Every", theory: "Every es singular.", en: "Every student has a book.", es: "Cada estudiante tiene un libro.", score: 0 },
            { sub: "6-8 Adjectives", theory: "Modifican al nombre.", en: "The tall man is my friend.", es: "El hombre alto es mi amigo.", score: 0 },
            { sub: "6-9 Noun Adj.", theory: "Nombre como adjetivo.", en: "I have a flower garden.", es: "Tengo un jard√≠n de flores.", score: 0 },
            { sub: "6-10 Pronouns", theory: "Objeto (Them).", en: "I like them.", es: "Me gustan.", score: 0 },
            { sub: "6-11 Possessive", theory: "Ap√≥strofe 'S.", en: "This is Tom's car.", es: "Este es el coche de Tom.", score: 0 },
            { sub: "6-11 Plural Poss.", theory: "Hermanos (Brothers').", en: "My brothers' names are Sam and Al.", es: "Los nombres de mis hermanos son Sam y Al.", score: 0 },
            { sub: "6-12 Poss. Adj.", theory: "Mi (My).", en: "This is my pen.", es: "Esta es mi pluma.", score: 0 },
            { sub: "6-12 Poss. Pron.", theory: "M√≠o (Mine).", en: "The pen is mine.", es: "La pluma es m√≠a.", score: 0 },
            { sub: "6-13 Reflexive", theory: "Mismo (Myself).", en: "I saw myself in the mirror.", es: "Me vi en el espejo.", score: 0 },
            { sub: "6-14 Another", theory: "Otro m√°s.", en: "I want another apple.", es: "Quiero otra manzana.", score: 0 },
            { sub: "6-15 Others", theory: "Los otros.", en: "Some are red, others are blue.", es: "Algunos son rojos, otros azules.", score: 0 },
            { sub: "6-3 Object", theory: "Pronombre Her.", en: "I saw her yesterday.", es: "La vi ayer.", score: 0 },
            { sub: "6-5 Time", theory: "D√≠as (On).", en: "See you on Monday.", es: "Te veo el lunes.", score: 0 },
            { sub: "6-8 Order", theory: "Dos adjetivos.", en: "A small dark room.", es: "Un cuarto peque√±o y oscuro.", score: 0 },
            { sub: "6-12 Posesivo", theory: "Su de ella (Her).", en: "Her hair is long.", es: "Su cabello es largo.", score: 0 },
            { sub: "6-13 Reflexivo", theory: "√âl mismo (Himself).", en: "He lives by himself.", es: "√âl vive solo.", score: 0 },
            { sub: "6-14 The other", theory: "El otro (espec√≠fico).", en: "One is big, the other is small.", es: "Uno es grande, el otro peque√±o.", score: 0 }
        ],
        "Cap√≠tulo 7: Modal Auxiliaries": [
            { sub: "7-2 Ability", theory: "Habilidad (Can).", en: "I can speak English.", es: "Puedo hablar ingl√©s.", score: 0 },
            { sub: "7-2 Past Ability", theory: "Pasado (Could).", en: "I could swim when I was five.", es: "Pod√≠a nadar cuando ten√≠a cinco.", score: 0 },
            { sub: "7-3 Possibility", theory: "Posibilidad (May).", en: "It may rain today.", es: "Puede que llueva hoy.", score: 0 },
            { sub: "7-3 Permission", theory: "Permiso formal.", en: "May I borrow your pen?", es: "¬øMe presta su pluma?", score: 0 },
            { sub: "7-4 Possibility", theory: "Cierta posibilidad (Could).", en: "It could be true.", es: "Podr√≠a ser cierto.", score: 0 },
            { sub: "7-5 Polite Quest.", theory: "Pregunta cort√©s (Can I).", en: "Can I help you?", es: "¬øPuedo ayudarle?", score: 0 },
            { sub: "7-6 Polite Request", theory: "Petici√≥n (Would you).", en: "Would you please open the door?", es: "¬øPodr√≠a abrir la puerta, por favor?", score: 0 },
            { sub: "7-7 Advice", theory: "Consejo (Should).", en: "You should study harder.", es: "Deber√≠as estudiar m√°s.", score: 0 },
            { sub: "7-8 Advice", theory: "Consejo urgente (Had better).", en: "You had better see a doctor.", es: "M√°s vale que veas a un m√©dico.", score: 0 },
            { sub: "7-9 Necessity", theory: "Obligaci√≥n (Have to).", en: "I have to go now.", es: "Tengo que irme ahora.", score: 0 },
            { sub: "7-9 Necessity", theory: "Obligaci√≥n fuerte (Must).", en: "You must stop at the red light.", es: "Debes parar en la luz roja.", score: 0 },
            { sub: "7-10 Lack of Nec.", theory: "No es necesario.", en: "You don't have to go.", es: "No tienes que ir.", score: 0 },
            { sub: "7-10 Prohibition", theory: "Prohibido (Must not).", en: "You must not smoke here.", es: "No debes fumar aqu√≠.", score: 0 },
            { sub: "7-11 Logic", theory: "Conclusi√≥n l√≥gica.", en: "She is yawning. She must be sleepy.", es: "Bosteza. Debe tener sue√±o.", score: 0 },
            { sub: "7-12 Tags", theory: "Tags con Modales.", en: "You can come, can't you?", es: "Puedes venir, ¬øverdad?", score: 0 },
            { sub: "7-13 Imperative", theory: "Instrucci√≥n.", en: "Close the window.", es: "Cierra la ventana.", score: 0 },
            { sub: "7-14 Suggestions", theory: "Sugesti√≥n (Let's).", en: "Let's go to the beach.", es: "Vamos a la playa.", score: 0 },
            { sub: "7-15 Preference", theory: "Preferencia (Rather).", en: "I would rather stay home.", es: "Preferir√≠a quedarme en casa.", score: 0 },
            { sub: "7-5 Cortesia", theory: "Petici√≥n (Could you).", en: "Could you tell me the time?", es: "¬øPodr√≠a decirme la hora?", score: 0 },
            { sub: "7-7 Consejo", theory: "Ought to.", en: "You ought to eat more fruit.", es: "Deber√≠as comer m√°s fruta.", score: 0 },
            { sub: "7-9 Obligaci√≥n", theory: "Have got to.", en: "I've got to study tonight.", es: "Tengo que estudiar esta noche.", score: 0 },
            { sub: "7-11 Deducci√≥n", theory: "Must not (L√≥gica).", en: "He must not like meat.", es: "No le debe gustar la carne.", score: 0 },
            { sub: "7-14 Sugerencia", theory: "Why don't we.", en: "Why don't we see a movie?", es: "¬øPor qu√© no vemos una peli?", score: 0 },
            { sub: "7-15 Preferir", theory: "Preferir A sobre B.", en: "I prefer tea to coffee.", es: "Prefiero el t√© al caf√©.", score: 0 },
            { sub: "7-13 Negativo", theory: "Imperativo negativo.", en: "Don't be late.", es: "No llegues tarde.", score: 0 }
        ],
        "Cap√≠tulo 8: Connecting Ideas": [
            { sub: "8-1 And", theory: "Uni√≥n simple.", en: "I saw a cat and a dog.", es: "Vi un gato y un perro.", score: 0 },
            { sub: "8-2 But", theory: "Contraste.", en: "I am tired but happy.", es: "Estoy cansado pero feliz.", score: 0 },
            { sub: "8-2 Or", theory: "Elecci√≥n.", en: "Do you want tea or coffee?", es: "¬øQuieres t√© o caf√©?", score: 0 },
            { sub: "8-3 So", theory: "Resultado.", en: "It was dark, so I turned on the light.", es: "Estaba oscuro, as√≠ que encend√≠ la luz.", score: 0 },
            { sub: "8-6 Because", theory: "Raz√≥n.", en: "He ate because he was hungry.", es: "Comi√≥ porque ten√≠a hambre.", score: 0 },
            { sub: "8-7 Even though", theory: "Concesi√≥n.", en: "I went out even though it was raining.", es: "Sal√≠ aunque estaba lloviendo.", score: 0 },
            { sub: "8-1 Series", theory: "Lista de tres.", en: "I bought milk, bread, and eggs.", es: "Compr√© leche, pan y huevos.", score: 0 },
            { sub: "8-4 Auxiliaries", theory: "Uso de 'Does' tras But.", en: "I don't like coffee, but my husband does.", es: "A m√≠ no me gusta el caf√©, pero a mi esposo s√≠.", score: 0 },
            { sub: "8-5 Too", theory: "Tambi√©n (final).", en: "I am hungry, and Tom is too.", es: "Tengo hambre, y Tom tambi√©n.", score: 0 },
            { sub: "8-5 So am I", theory: "Tambi√©n yo (inicio).", en: "I am tired. So am I.", es: "Estoy cansado. Yo tambi√©n.", score: 0 },
            { sub: "8-5 Either", theory: "Tampoco (final).", en: "I don't swim, and Joe doesn't either.", es: "Yo no nado, y Joe tampoco.", score: 0 },
            { sub: "8-5 Neither", theory: "Tampoco yo (inicio).", en: "I'm not hungry. Neither am I.", es: "No tengo hambre. Ni yo.", score: 0 },
            { sub: "8-6 Adverb Clause", theory: "Porque (inicio).", en: "Because I was tired, I went to bed.", es: "Como estaba cansado, me fui a dormir.", score: 0 },
            { sub: "8-7 Although", theory: "Aunque.", en: "Although he is rich, he is unhappy.", es: "Aunque es rico, es infeliz.", score: 0 },
            { sub: "8-2 Contrast", theory: "Oposici√≥n.", en: "The movie was long but interesting.", es: "La pel√≠cula fue larga pero interesante.", score: 0 },
            { sub: "8-3 Result", theory: "Conclusi√≥n.", en: "I was sick, so I stayed home.", es: "Estaba enfermo, as√≠ que me qued√© en casa.", score: 0 },
            { sub: "8-1 Addition", theory: "Suma.", en: "She is smart and beautiful.", es: "Ella es lista y hermosa.", score: 0 },
            { sub: "8-5 Agreement", theory: "Yo tambi√©n (Can).", en: "I can dance. So can I.", es: "S√© bailar. Yo tambi√©n.", score: 0 },
            { sub: "8-5 Tampoco", theory: "Ni yo (Have).", en: "I haven't seen it. Neither have I.", es: "No lo he visto. Ni yo.", score: 0 },
            { sub: "8-6 Causa", theory: "Causa.", en: "She's crying because she's sad.", es: "Llora porque est√° triste.", score: 0 },
            { sub: "8-7 Oposici√≥n", theory: "Oposici√≥n.", en: "She failed even though she studied.", es: "Reprob√≥ aunque estudi√≥.", score: 0 },
            { sub: "8-2 Opciones", theory: "Opciones.", en: "Is he a doctor or a nurse?", es: "¬ø√âl es doctor o enfermero?", score: 0 },
            { sub: "8-4 Respuestas", theory: "Respuestas cortas.", en: "They can't go, but we can.", es: "Ellos no pueden ir, pero nosotros s√≠.", score: 0 },
            { sub: "8-1 Sujeto", theory: "Sujeto doble.", en: "My mom and dad are here.", es: "Mi mam√° y pap√° est√°n aqu√≠.", score: 0 },
            { sub: "8-3 Consecuencia", theory: "Consecuencia.", en: "I forgot my wallet, so I have no money.", es: "Olvid√© mi cartera, as√≠ que no tengo dinero.", score: 0 }
        ],
        "Cap√≠tulo 9: Comparisons": [
            { sub: "9-1 As...As", theory: "Igualdad.", en: "I am as tall as my brother.", es: "Soy tan alto como mi hermano.", score: 0 },
            { sub: "9-2 Comparative", theory: "Er (Cortos).", en: "An elephant is larger than a dog.", es: "Un elefante es m√°s grande que un perro.", score: 0 },
            { sub: "9-2 Comparative", theory: "More (Largos).", en: "Health is more important than money.", es: "La salud es m√°s importante que el dinero.", score: 0 },
            { sub: "9-2 Superlative", theory: "Est (Cortos).", en: "The Nile is the longest river.", es: "El Nilo es el r√≠o m√°s largo.", score: 0 },
            { sub: "9-2 Superlative", theory: "Most (Largos).", en: "This is the most interesting book.", es: "Este es el libro m√°s interesante.", score: 0 },
            { sub: "9-3 Irregular", theory: "Good - Better - Best.", en: "This cake is the best.", es: "Este pastel es el mejor.", score: 0 },
            { sub: "9-3 Irregular", theory: "Bad - Worse - Worst.", en: "The weather is worse today.", es: "El clima est√° peor hoy.", score: 0 },
            { sub: "9-5 Modifiers", theory: "Much (Mucho m√°s).", en: "Tokyo is much bigger than Kyoto.", es: "Tokio es mucho m√°s grande que Kioto.", score: 0 },
            { sub: "9-5 Modifiers", theory: "A little (Un poco).", en: "He is a little older than me.", es: "√âl es un poco mayor que yo.", score: 0 },
            { sub: "9-6 Less", theory: "Menos que.", en: "A pen is less expensive than a watch.", es: "Una pluma es menos cara que un reloj.", score: 0 },
            { sub: "9-8 Repeating", theory: "Progresi√≥n.", en: "It is getting harder and harder.", es: "Se est√° poniendo cada vez m√°s dif√≠cil.", score: 0 },
            { sub: "9-9 Double Comp.", theory: "Cuanto m√°s... m√°s...", en: "The harder you study, the more you learn.", es: "Cuanto m√°s estudias, m√°s aprendes.", score: 0 },
            { sub: "9-11 Alike", theory: "Parecidos.", en: "The two brothers are alike.", es: "Los dos hermanos se parecen.", score: 0 },
            { sub: "9-11 The same", theory: "Iguales.", en: "We have the same car.", es: "Tenemos el mismo coche.", score: 0 },
            { sub: "9-11 Different", theory: "Diferente a (From).", en: "My car is different from yours.", es: "Mi coche es diferente al tuyo.", score: 0 },
            { sub: "9-1 Negativo", theory: "No tanto como.", en: "He is not as old as he looks.", es: "No es tan viejo como parece.", score: 0 },
            { sub: "9-2 Than", theory: "Than (Comparativa).", en: "I am faster than you.", es: "Soy m√°s r√°pido que t√∫.", score: 0 },
            { sub: "9-11 Similar", theory: "Similar.", en: "This book is similar to that one.", es: "Este libro es similar a ese.", score: 0 },
            { sub: "9-3 Far", theory: "Lejos (Farther).", en: "I ran farther than him.", es: "Corr√≠ m√°s lejos que √©l.", score: 0 },
            { sub: "9-1 Igualdad", theory: "Igual de r√°pido.", en: "He speaks as fast as he can.", es: "√âl habla tan r√°pido como puede.", score: 0 },
            { sub: "9-5 A lot", theory: "Mucho mejor.", en: "I feel a lot better now.", es: "Me siento mucho mejor ahora.", score: 0 },
            { sub: "9-8 Better", theory: "Cada vez mejor.", en: "Your English is getting better and better.", es: "Tu ingl√©s mejora cada vez m√°s.", score: 0 },
            { sub: "9-9 Sooner", theory: "Cuanto antes mejor.", en: "The sooner, the better.", es: "Cuanto antes, mejor.", score: 0 },
            { sub: "9-11 Senses", theory: "Parece (Looks like).", en: "It looks like rain.", es: "Parece que va a llover.", score: 0 },
            { sub: "9-2 Superlativo", theory: "En el mundo.", en: "It's the tallest building in the world.", es: "Es el edificio m√°s alto del mundo.", score: 0 }
        ],
        "Cap√≠tulo 10: The Passive": [
            { sub: "10-1 Active/Passive", theory: "Enfoque en el objeto.", en: "The mouse was eaten by the cat.", es: "El rat√≥n fue comido por el gato.", score: 0 },
            { sub: "10-2 Form", theory: "Be + Participio.", en: "Rice is grown in Asia.", es: "El arroz se cultiva en Asia.", score: 0 },
            { sub: "10-2 Past Passive", theory: "Fue hecho.", en: "This house was built in 1940.", es: "Esta casa fue construida en 1940.", score: 0 },
            { sub: "10-2 Future Passive", theory: "Ser√° enviado.", en: "The letter will be sent tomorrow.", es: "La carta ser√° enviada ma√±ana.", score: 0 },
            { sub: "10-4 By-Phrase", theory: "Qui√©n lo hizo.", en: "The book was written by Betty Azar.", es: "El libro fue escrito por Betty Azar.", score: 0 },
            { sub: "10-5 Modals", theory: "Debe hacerse.", en: "The room must be cleaned.", es: "El cuarto debe ser limpiado.", score: 0 },
            { sub: "10-5 Modals", theory: "Puede hacerse.", en: "It can be done.", es: "Puede hacerse.", score: 0 },
            { sub: "10-6 Stative Pass.", theory: "Estado (Married).", en: "Paul is married to Susan.", es: "Paul est√° casado con Susan.", score: 0 },
            { sub: "10-6 Stative Pass.", theory: "Estado (Interesado).", en: "I am interested in art.", es: "Estoy interesado en el arte.", score: 0 },
            { sub: "10-6 Prepositions", theory: "Preocupado (Worried).", en: "I am worried about you.", es: "Estoy preocupado por ti.", score: 0 },
            { sub: "10-7 Participial Adj.", theory: "-ed vs -ing (Bored).", en: "I am bored.", es: "Estoy aburrido.", score: 0 },
            { sub: "10-7 Participial Adj.", theory: "-ed vs -ing (Boring).", en: "The movie is boring.", es: "La pel√≠cula es aburrida.", score: 0 },
            { sub: "10-8 Get + Adjective", theory: "Cambio (Get hungry).", en: "I am getting hungry.", es: "Me est√° dando hambre.", score: 0 },
            { sub: "10-8 Get + Participle", theory: "Casarse (Get married).", en: "They are getting married.", es: "Se van a casar.", score: 0 },
            { sub: "10-9 Be used to", theory: "Estar acostumbrado.", en: "I am used to hot weather.", es: "Estoy acostumbrado al clima c√°lido.", score: 0 },
            { sub: "10-9 Get used to", theory: "Acostumbrarse.", en: "I am getting used to the noise.", es: "Me estoy acostumbrando al ruido.", score: 0 },
            { sub: "10-11 Be supposed to", theory: "Se supone que...", en: "I am supposed to be there at eight.", es: "Se supone que debo estar ah√≠ a las ocho.", score: 0 },
            { sub: "10-1 Passive", theory: "Mailed (Enviado).", en: "The package was mailed by Leo.", es: "El paquete fue enviado por Leo.", score: 0 },
            { sub: "10-2 Present Pass.", theory: "Es hecho.", en: "English is spoken here.", es: "Aqu√≠ se habla ingl√©s.", score: 0 },
            { sub: "10-5 Should", theory: "Deber√≠a ser.", en: "He should be punished.", es: "Deber√≠a ser castigado.", score: 0 },
            { sub: "10-6 Tired", theory: "Cansado (De).", en: "I am tired of this cold weather.", es: "Estoy cansado de este clima fr√≠o.", score: 0 },
            { sub: "10-7 Scared", theory: "Asustado.", en: "The children were scared.", es: "Los ni√±os estaban asustados.", score: 0 },
            { sub: "10-8 Lost", theory: "Perderse.", en: "We got lost in the city.", es: "Nos perdimos en la ciudad.", score: 0 },
            { sub: "10-9 Custom", theory: "H√°bito.", en: "He's used to working hard.", es: "√âl est√° acostumbrado a trabajar duro.", score: 0 },
            { sub: "10-11 Expectation", theory: "Expectativa.", en: "We are supposed to write a report.", es: "Se supone que debemos escribir un reporte.", score: 0 }
        ]
    };

    // LOGICA DE LA APLICACION
    let azarBook = JSON.parse(localStorage.getItem('azar_master_v9')) || rawData;
    let currentCh = Object.keys(azarBook)[0];
    let currentSec = 0;
    let auto = false;
    const synth = window.speechSynthesis;
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = Speech ? new Speech() : null;

    if(rec) {
        rec.lang = 'en-US';
        rec.onresult = (e) => {
            const transcript = e.results[0][0].transcript.toLowerCase();
            compare(transcript);
        };
        rec.onend = () => document.getElementById('recBtn').classList.remove('active');
    }

    function initSidebar() {
        const list = document.getElementById('chapter-list');
        list.innerHTML = '';
        Object.keys(azarBook).forEach(ch => {
            const btn = document.createElement('a');
            btn.className = `chapter-link ${ch === currentCh ? 'active' : ''}`;
            btn.innerText = ch;
            btn.onclick = () => { currentCh = ch; currentSec = 0; selectChapter(); };
            list.appendChild(btn);
        });
    }

    function selectChapter() {
        initSidebar();
        updateLesson();
        refreshStats();
    }

    function updateLesson() {
        const data = azarBook[currentCh];
        const item = data[currentSec];
        document.getElementById('unit-info').innerText = `UNIT: ${currentSec + 1} / ${data.length}`;
        document.getElementById('theory-display').innerHTML = `<strong>SUBTEMA: ${item.sub}</strong><br>REGLA: ${item.theory}`;
        document.getElementById('display-en').innerText = item.en;
        document.getElementById('display-es').innerText = item.es;
        document.getElementById('score-val').innerText = item.score > 0 ? item.score + "%" : "--";
        localStorage.setItem('azar_master_v9', JSON.stringify(azarBook));
    }

    function speak() {
        synth.cancel();
        const msg = new SpeechSynthesisUtterance(azarBook[currentCh][currentSec].en);
        msg.lang = 'en-US';
        msg.rate = 0.85;
        msg.onend = () => { if(auto && currentSec < azarBook[currentCh].length - 1) setTimeout(() => move(1), 1500); };
        synth.speak(msg);
    }

    function record() {
        if(!rec) return alert("Navegador no compatible");
        document.getElementById('recBtn').classList.add('active');
        document.getElementById('transcript-txt').innerText = "Linking to Neural Network...";
        rec.start();
    }

    function compare(spoken) {
        const target = azarBook[currentCh][currentSec].en.toLowerCase().replace(/[^\w\s]/g, '');
        const targetWords = target.split(' ');
        const spokenWords = spoken.split(' ');
        
        let html = '';
        let matches = 0;
        targetWords.forEach(w => {
            if(spokenWords.includes(w)) {
                html += `<span class="match">${w}</span> `;
                matches++;
            } else {
                html += `<span class="miss">${w}</span> `;
            }
        });
        
        const score = Math.round((matches / targetWords.length) * 100);
        document.getElementById('diff-visual').innerHTML = html;
        document.getElementById('score-val').innerText = score + "%";
        document.getElementById('transcript-txt').innerText = `Neural Echo: "${spoken}"`;
        
        azarBook[currentCh][currentSec].score = Math.max(azarBook[currentCh][currentSec].score, score);
        updateLesson();
        refreshStats();
    }

    function move(d) {
        const len = azarBook[currentCh].length;
        currentSec = (currentSec + d + len) % len;
        resetFeedback();
        updateLesson();
        if(auto) speak();
    }

    function resetFeedback() {
        document.getElementById('diff-visual').innerText = "...";
        document.getElementById('score-val').innerText = "--";
        document.getElementById('transcript-txt').innerText = "Neural Link: Standby";
    }

    function toggleAuto() {
        auto = !auto;
        document.getElementById('autoBtn').style.background = auto ? 'white' : 'black';
        document.getElementById('autoBtn').style.color = auto ? 'black' : 'var(--m-green)';
        if(auto) speak();
    }

    function refreshStats() {
        let totalScore = 0;
        let totalItems = 0;
        let mastered = 0;

        Object.values(azarBook).forEach(ch => {
            ch.forEach(item => {
                totalScore += item.score;
                totalItems++;
                if(item.score >= 90) mastered++;
            });
        });

        const avg = Math.round(totalScore / totalItems);
        document.getElementById('accuracy-val').innerText = avg + "%";
        document.getElementById('mastered-val').innerText = mastered;

        let rank = "BATTERY";
        if(avg > 20) rank = "COPPER TOP";
        if(avg > 50) rank = "POTENTIAL";
        if(avg > 80) rank = "RED PILL";
        if(avg > 95) rank = "THE ONE";
        document.getElementById('rank-val').innerText = rank;
    }

    function addNew() {
        const sub = document.getElementById('in-sub').value;
        const theory = document.getElementById('in-theory').value;
        const en = document.getElementById('in-en').value;
        const es = document.getElementById('in-es').value;
        if(en && es) {
            azarBook[currentCh].push({ sub, theory, en, es, score: 0 });
            currentSec = azarBook[currentCh].length - 1;
            updateLesson();
        }
    }

    function resetAll() { if(confirm("¬øReiniciar Matrix?")) { localStorage.clear(); location.reload(); } }
    
    function exportData() {
        const blob = new Blob([JSON.stringify(azarBook)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = "azar_master_backup.json"; a.click();
    }

    window.onload = selectChapter;
</script>

</body>
</html>